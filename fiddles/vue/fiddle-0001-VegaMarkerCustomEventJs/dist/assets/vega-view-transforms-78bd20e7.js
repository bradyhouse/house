import{T as S}from"./vega-dataflow-7e3fa937.js";import{B as J,h as Pt,b as jt,I as Gt,M as Ht,A as gt,l as kt}from"./vega-scenegraph-d3a31be7.js";import{u as Y,V as Q,C as Vt}from"./vega-util-7f144c9d.js";const N="top",D="left",B="right",H="bottom",vt="top-left",Nt="top-right",Yt="bottom-left",qt="bottom-right",tt="start",Z="middle",z="end",Ut="x",Wt="y",K="group",nt="axis",ot="title",Xt="frame",$t="scope",et="legend",Mt="row-header",wt="row-footer",pt="row-title",Et="column-header",Rt="column-footer",At="column-title",Jt="padding",Kt="symbol",Lt="fit",Tt="fit-x",zt="fit-y",Qt="pad",at="none",U="all",_="each",rt="flush",j="column",G="row";function Ot(n){S.call(this,null,n)}Y(Ot,S,{transform(n,t){const o=t.dataflow,r=n.mark,a=r.marktype,i=Ht[a],s=i.bound;let c=r.bounds,l;if(i.nested)r.items.length&&o.dirty(r.items[0]),c=W(r,s),r.items.forEach(u=>{u.bounds.clear().union(c)});else if(a===K||n.modified())switch(t.visit(t.MOD,u=>o.dirty(u)),c.clear(),r.items.forEach(u=>c.union(W(u,s))),r.role){case nt:case et:case ot:t.reflow()}else l=t.changed(t.REM),t.visit(t.ADD,u=>{c.union(W(u,s))}),t.visit(t.MOD,u=>{l=l||c.alignsWith(u.bounds),o.dirty(u),c.union(W(u,s))}),l&&(c.clear(),r.items.forEach(u=>c.union(u.bounds)));return Pt(r),t.modifies("bounds")}});function W(n,t,o){return t(n.bounds.clear(),n,o)}const dt=":vega_identifier:";function it(n){S.call(this,0,n)}it.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};Y(it,S,{transform(n,t){const o=Zt(t.dataflow),r=n.as;let a=o.value;return t.visit(t.ADD,i=>i[r]=i[r]||++a),o.set(this.value=a),t}});function Zt(n){return n._signals[dt]||(n._signals[dt]=n.add(0))}function It(n){S.call(this,null,n)}Y(It,S,{transform(n,t){let o=this.value;o||(o=t.dataflow.scenegraph().mark(n.markdef,_t(n),n.index),o.group.context=n.context,n.context.group||(n.context.group=o.group),o.source=this.source,o.clip=n.clip,o.interactive=n.interactive,this.value=o);const r=o.marktype===K?jt:Gt;return t.visit(t.ADD,a=>r.call(a,o)),(n.modified("clip")||n.modified("interactive"))&&(o.clip=n.clip,o.interactive=!!n.interactive,o.zdirty=!0,t.reflow()),o.items=t.source,t}});function _t(n){const t=n.groups,o=n.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&o?t.lookup(o):null}function Ft(n){S.call(this,null,n)}const lt={parity:n=>n.filter((t,o)=>o%2?t.opacity=0:1),greedy:(n,t)=>{let o;return n.filter((r,a)=>!a||!Ct(o.bounds,r.bounds,t)?(o=r,1):r.opacity=0)}},Ct=(n,t,o)=>o>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2),ut=(n,t)=>{for(var o=1,r=n.length,a=n[0].bounds,i;o<r;a=i,++o)if(Ct(a,i=n[o].bounds,t))return!0},tn=n=>{const t=n.bounds;return t.width()>1&&t.height()>1},nn=(n,t,o)=>{var r=n.range(),a=new J;return t===N||t===H?a.set(r[0],-1/0,r[1],1/0):a.set(-1/0,r[0],1/0,r[1]),a.expand(o||1),i=>a.encloses(i.bounds)},ft=n=>(n.forEach(t=>t.opacity=1),n),ht=(n,t)=>n.reflow(t.modified()).modifies("opacity");Y(Ft,S,{transform(n,t){const o=lt[n.method]||lt.parity,r=n.separation||0;let a=t.materialize(t.SOURCE).source,i,s;if(!a||!a.length)return;if(!n.method)return n.modified("method")&&(ft(a),t=ht(t,n)),t;if(a=a.filter(tn),!a.length)return;if(n.sort&&(a=a.slice().sort(n.sort)),i=ft(a),t=ht(t,n),i.length>=3&&ut(i,r)){do i=o(i,r);while(i.length>=3&&ut(i,r));i.length<3&&!Q(a).opacity&&(i.length>1&&(Q(i).opacity=0),Q(a).opacity=1)}n.boundScale&&n.boundTolerance>=0&&(s=nn(n.boundScale,n.boundOrient,+n.boundTolerance),a.forEach(l=>{s(l)||(l.opacity=0)}));const c=i[0].mark.bounds.clear();return a.forEach(l=>{l.opacity&&c.union(l.bounds)}),t}});function St(n){S.call(this,null,n)}Y(St,S,{transform(n,t){const o=t.dataflow;if(t.visit(t.ALL,r=>o.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const T=new J;function v(n,t,o){return n[t]===o?0:(n[t]=o,1)}function on(n){var t=n.items[0].orient;return t===D||t===B}function en(n){let t=+n.grid;return[n.ticks?t++:-1,n.labels?t++:-1,t+ +n.domain]}function an(n,t,o,r){var a=t.items[0],i=a.datum,s=a.translate!=null?a.translate:.5,c=a.orient,l=en(i),u=a.range,d=a.offset,y=a.position,h=a.minExtent,x=a.maxExtent,b=i.title&&a.items[l[2]].items[0],g=a.titlePadding,f=a.bounds,m=b&&gt(b),k=0,M=0,A,E;switch(T.clear().union(f),f.clear(),(A=l[0])>-1&&f.union(a.items[A].bounds),(A=l[1])>-1&&f.union(a.items[A].bounds),c){case N:k=y||0,M=-d,E=Math.max(h,Math.min(x,-f.y1)),f.add(0,-E).add(u,0),b&&X(n,b,E,g,m,0,-1,f);break;case D:k=-d,M=y||0,E=Math.max(h,Math.min(x,-f.x1)),f.add(-E,0).add(0,u),b&&X(n,b,E,g,m,1,-1,f);break;case B:k=o+d,M=y||0,E=Math.max(h,Math.min(x,f.x2)),f.add(0,0).add(E,u),b&&X(n,b,E,g,m,1,1,f);break;case H:k=y||0,M=r+d,E=Math.max(h,Math.min(x,f.y2)),f.add(0,0).add(u,E),b&&X(n,b,E,g,0,0,1,f);break;default:k=a.x,M=a.y}return kt(f.translate(k,M),a),v(a,"x",k+s)|v(a,"y",M+s)&&(a.bounds=T,n.dirty(a),a.bounds=f,n.dirty(a)),a.mark.bounds.clear().union(f)}function X(n,t,o,r,a,i,s,c){const l=t.bounds;if(t.auto){const u=s*(o+a+r);let d=0,y=0;n.dirty(t),i?d=(t.x||0)-(t.x=u):y=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-d,-y)),n.dirty(t)}c.union(l)}const yt=(n,t)=>Math.floor(Math.min(n,t)),mt=(n,t)=>Math.ceil(Math.max(n,t));function rn(n){var t=n.items,o=t.length,r=0,a,i;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<o;++r)if(a=t[r],i=a.items,a.marktype===K)switch(a.role){case nt:case et:case ot:break;case Mt:s.rowheaders.push(...i);break;case wt:s.rowfooters.push(...i);break;case Et:s.colheaders.push(...i);break;case Rt:s.colfooters.push(...i);break;case pt:s.rowtitle=i[0];break;case At:s.coltitle=i[0];break;default:s.marks.push(...i)}return s}function sn(n){return new J().set(0,0,n.width||0,n.height||0)}function cn(n){const t=n.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(n.x||0),-(n.y||0))}function w(n,t,o){const r=Vt(n)?n[t]:n;return r??(o!==void 0?o:0)}function bt(n){return n<0?Math.ceil(-n):0}function Dt(n,t,o){var r=!o.nodirty,a=o.bounds===rt?sn:cn,i=T.set(0,0,0,0),s=w(o.align,j),c=w(o.align,G),l=w(o.padding,j),u=w(o.padding,G),d=o.columns||t.length,y=d<=0?1:Math.ceil(t.length/d),h=t.length,x=Array(h),b=Array(d),g=0,f=Array(h),m=Array(y),k=0,M=Array(h),A=Array(h),E=Array(h),O,e,p,R,P,F,st,ct,I,C,L;for(e=0;e<d;++e)b[e]=0;for(e=0;e<y;++e)m[e]=0;for(e=0;e<h;++e)F=t[e],P=E[e]=a(F),F.x=F.x||0,M[e]=0,F.y=F.y||0,A[e]=0,p=e%d,R=~~(e/d),g=Math.max(g,st=Math.ceil(P.x2)),k=Math.max(k,ct=Math.ceil(P.y2)),b[p]=Math.max(b[p],st),m[R]=Math.max(m[R],ct),x[e]=l+bt(P.x1),f[e]=u+bt(P.y1),r&&n.dirty(t[e]);for(e=0;e<h;++e)e%d===0&&(x[e]=0),e<d&&(f[e]=0);if(s===_)for(p=1;p<d;++p){for(L=0,e=p;e<h;e+=d)L<x[e]&&(L=x[e]);for(e=p;e<h;e+=d)x[e]=L+b[p-1]}else if(s===U){for(L=0,e=0;e<h;++e)e%d&&L<x[e]&&(L=x[e]);for(e=0;e<h;++e)e%d&&(x[e]=L+g)}else for(s=!1,p=1;p<d;++p)for(e=p;e<h;e+=d)x[e]+=b[p-1];if(c===_)for(R=1;R<y;++R){for(L=0,e=R*d,O=e+d;e<O;++e)L<f[e]&&(L=f[e]);for(e=R*d;e<O;++e)f[e]=L+m[R-1]}else if(c===U){for(L=0,e=d;e<h;++e)L<f[e]&&(L=f[e]);for(e=d;e<h;++e)f[e]=L+k}else for(c=!1,R=1;R<y;++R)for(e=R*d,O=e+d;e<O;++e)f[e]+=m[R-1];for(I=0,e=0;e<h;++e)I=x[e]+(e%d?I:0),M[e]+=I-t[e].x;for(p=0;p<d;++p)for(C=0,e=p;e<h;e+=d)C+=f[e],A[e]+=C-t[e].y;if(s&&w(o.center,j)&&y>1)for(e=0;e<h;++e)P=s===U?g:b[e%d],I=P-E[e].x2-t[e].x-M[e],I>0&&(M[e]+=I/2);if(c&&w(o.center,G)&&d!==1)for(e=0;e<h;++e)P=c===U?k:m[~~(e/d)],C=P-E[e].y2-t[e].y-A[e],C>0&&(A[e]+=C/2);for(e=0;e<h;++e)i.union(E[e].translate(M[e],A[e]));switch(I=w(o.anchor,Ut),C=w(o.anchor,Wt),w(o.anchor,j)){case z:I-=i.width();break;case Z:I-=i.width()/2}switch(w(o.anchor,G)){case z:C-=i.height();break;case Z:C-=i.height()/2}for(I=Math.round(I),C=Math.round(C),i.clear(),e=0;e<h;++e)t[e].mark.bounds.clear();for(e=0;e<h;++e)F=t[e],F.x+=M[e]+=I,F.y+=A[e]+=C,i.union(F.mark.bounds.union(F.bounds.translate(M[e],A[e]))),r&&n.dirty(F);return i}function dn(n,t,o){var r=rn(t),a=r.marks,i=o.bounds===rt?ln:un,s=o.offset,c=o.columns||a.length,l=c<=0?1:Math.ceil(a.length/c),u=l*c,d,y,h,x,b,g,f;const m=Dt(n,a,o);m.empty()&&m.set(0,0,0,0),r.rowheaders&&(g=w(o.headerBand,G,null),d=$(n,r.rowheaders,a,c,l,-w(s,"rowHeader"),yt,0,i,"x1",0,c,1,g)),r.colheaders&&(g=w(o.headerBand,j,null),y=$(n,r.colheaders,a,c,c,-w(s,"columnHeader"),yt,1,i,"y1",0,1,c,g)),r.rowfooters&&(g=w(o.footerBand,G,null),h=$(n,r.rowfooters,a,c,l,w(s,"rowFooter"),mt,0,i,"x2",c-1,c,1,g)),r.colfooters&&(g=w(o.footerBand,j,null),x=$(n,r.colfooters,a,c,c,w(s,"columnFooter"),mt,1,i,"y2",u-c,1,c,g)),r.rowtitle&&(b=w(o.titleAnchor,G),f=w(s,"rowTitle"),f=b===z?h+f:d-f,g=w(o.titleBand,G,.5),xt(n,r.rowtitle,f,0,m,g)),r.coltitle&&(b=w(o.titleAnchor,j),f=w(s,"columnTitle"),f=b===z?x+f:y-f,g=w(o.titleBand,j,.5),xt(n,r.coltitle,f,1,m,g))}function ln(n,t){return t==="x1"?n.x||0:t==="y1"?n.y||0:t==="x2"?(n.x||0)+(n.width||0):t==="y2"?(n.y||0)+(n.height||0):void 0}function un(n,t){return n.bounds[t]}function $(n,t,o,r,a,i,s,c,l,u,d,y,h,x){var b=o.length,g=0,f=0,m,k,M,A,E,O,e,p,R;if(!b)return g;for(m=d;m<b;m+=y)o[m]&&(g=s(g,l(o[m],u)));if(!t.length)return g;for(t.length>a&&(n.warn("Grid headers exceed limit: "+a),t=t.slice(0,a)),g+=i,k=0,A=t.length;k<A;++k)n.dirty(t[k]),t[k].mark.bounds.clear();for(m=d,k=0,A=t.length;k<A;++k,m+=y){for(O=t[k],E=O.mark.bounds,M=m;M>=0&&(e=o[M])==null;M-=h);c?(p=x==null?e.x:Math.round(e.bounds.x1+x*e.bounds.width()),R=g):(p=g,R=x==null?e.y:Math.round(e.bounds.y1+x*e.bounds.height())),E.union(O.bounds.translate(p-(O.x||0),R-(O.y||0))),O.x=p,O.y=R,n.dirty(O),f=s(f,E[u])}return f}function xt(n,t,o,r,a,i){if(t){n.dirty(t);var s=o,c=o;r?s=Math.round(a.x1+i*a.width()):c=Math.round(a.y1+i*a.height()),t.bounds.translate(s-(t.x||0),c-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=c,n.dirty(t)}}function fn(n,t){const o=n[t]||{};return(r,a)=>o[r]!=null?o[r]:n[r]!=null?n[r]:a}function hn(n,t){let o=-1/0;return n.forEach(r=>{r.offset!=null&&(o=Math.max(o,r.offset))}),o>-1/0?o:t}function yn(n,t,o,r,a,i,s){const c=fn(o,t),l=hn(n,c("offset",0)),u=c("anchor",tt),d=u===z?1:u===Z?.5:0,y={align:_,bounds:c("bounds",rt),columns:c("direction")==="vertical"?1:n.length,padding:c("margin",8),center:c("center"),nodirty:!0};switch(t){case D:y.anchor={x:Math.floor(r.x1)-l,column:z,y:d*(s||r.height()+2*r.y1),row:u};break;case B:y.anchor={x:Math.ceil(r.x2)+l,y:d*(s||r.height()+2*r.y1),row:u};break;case N:y.anchor={y:Math.floor(a.y1)-l,row:z,x:d*(i||a.width()+2*a.x1),column:u};break;case H:y.anchor={y:Math.ceil(a.y2)+l,x:d*(i||a.width()+2*a.x1),column:u};break;case vt:y.anchor={x:l,y:l};break;case Nt:y.anchor={x:i-l,y:l,column:z};break;case Yt:y.anchor={x:l,y:s-l,row:z};break;case qt:y.anchor={x:i-l,y:s-l,column:z,row:z};break}return y}function mn(n,t){var o=t.items[0],r=o.datum,a=o.orient,i=o.bounds,s=o.x,c=o.y,l,u;return o._bounds?o._bounds.clear().union(i):o._bounds=i.clone(),i.clear(),xn(n,o,o.items[0].items[0]),i=bn(o,i),l=2*o.padding,u=2*o.padding,i.empty()||(l=Math.ceil(i.width()+l),u=Math.ceil(i.height()+u)),r.type===Kt&&gn(o.items[0].items[0].items[0].items),a!==at&&(o.x=s=0,o.y=c=0),o.width=l,o.height=u,kt(i.set(s,c,s+l,c+u),o),o.mark.bounds.clear().union(i),o}function bn(n,t){return n.items.forEach(o=>t.union(o.bounds)),t.x1=n.padding,t.y1=n.padding,t}function xn(n,t,o){var r=t.padding,a=r-o.x,i=r-o.y;if(!t.datum.title)(a||i)&&q(n,o,a,i);else{var s=t.items[1].items[0],c=s.anchor,l=t.titlePadding||0,u=r-s.x,d=r-s.y;switch(s.orient){case D:a+=Math.ceil(s.bounds.width())+l;break;case B:case H:break;default:i+=s.bounds.height()+l}switch((a||i)&&q(n,o,a,i),s.orient){case D:d+=V(t,o,s,c,1,1);break;case B:u+=V(t,o,s,z,0,0)+l,d+=V(t,o,s,c,1,1);break;case H:u+=V(t,o,s,c,0,0),d+=V(t,o,s,z,-1,0,1)+l;break;default:u+=V(t,o,s,c,0,0)}(u||d)&&q(n,s,u,d),(u=Math.round(s.bounds.x1-r))<0&&(q(n,o,-u,0),q(n,s,-u,0))}}function V(n,t,o,r,a,i,s){const c=n.datum.type!=="symbol",l=o.datum.vgrad,u=c&&(i||!l)&&!s?t.items[0]:t,d=u.bounds[a?"y2":"x2"]-n.padding,y=l&&i?d:0,h=l&&i?0:d,x=a<=0?0:gt(o);return Math.round(r===tt?y:r===z?h-x:.5*(d-x))}function q(n,t,o,r){t.x+=o,t.y+=r,t.bounds.translate(o,r),t.mark.bounds.translate(o,r),n.dirty(t)}function gn(n){const t=n.reduce((o,r)=>(o[r.column]=Math.max(r.bounds.x2-r.x,o[r.column]||0),o),{});n.forEach(o=>{o.width=t[o.column],o.height=o.bounds.y2-o.y})}function kn(n,t,o,r,a){var i=t.items[0],s=i.frame,c=i.orient,l=i.anchor,u=i.offset,d=i.padding,y=i.items[0].items[0],h=i.items[1]&&i.items[1].items[0],x=c===D||c===B?r:o,b=0,g=0,f=0,m=0,k=0,M;if(s!==K?c===D?(b=a.y2,x=a.y1):c===B?(b=a.y1,x=a.y2):(b=a.x1,x=a.x2):c===D&&(b=r,x=0),M=l===tt?b:l===z?x:(b+x)/2,h&&h.text){switch(c){case N:case H:k=y.bounds.height()+d;break;case D:m=y.bounds.width()+d;break;case B:m=-y.bounds.width()-d;break}T.clear().union(h.bounds),T.translate(m-(h.x||0),k-(h.y||0)),v(h,"x",m)|v(h,"y",k)&&(n.dirty(h),h.bounds.clear().union(T),h.mark.bounds.clear().union(T),n.dirty(h)),T.clear().union(h.bounds)}else T.clear();switch(T.union(y.bounds),c){case N:g=M,f=a.y1-T.height()-u;break;case D:g=a.x1-T.width()-u,f=M;break;case B:g=a.x2+T.width()+u,f=M;break;case H:g=M,f=a.y2+u;break;default:g=i.x,f=i.y}return v(i,"x",g)|v(i,"y",f)&&(T.translate(g,f),n.dirty(i),i.bounds.clear().union(T),t.bounds.clear().union(T),n.dirty(i)),i.bounds}function Bt(n){S.call(this,null,n)}Y(Bt,S,{transform(n,t){const o=t.dataflow;return n.mark.items.forEach(r=>{n.layout&&dn(o,r,n.layout),wn(o,r,n)}),Mn(n.mark.group)?t.reflow():t}});function Mn(n){return n&&n.mark.role!=="legend-entry"}function wn(n,t,o){var r=t.items,a=Math.max(0,t.width||0),i=Math.max(0,t.height||0),s=new J().set(0,0,a,i),c=s.clone(),l=s.clone(),u=[],d,y,h,x,b,g;for(b=0,g=r.length;b<g;++b)switch(y=r[b],y.role){case nt:x=on(y)?c:l,x.union(an(n,y,a,i));break;case ot:d=y;break;case et:u.push(mn(n,y));break;case Xt:case $t:case Mt:case wt:case pt:case Et:case Rt:case At:c.union(y.bounds),l.union(y.bounds);break;default:s.union(y.bounds)}if(u.length){const f={};u.forEach(m=>{h=m.orient||B,h!==at&&(f[h]||(f[h]=[])).push(m)});for(const m in f){const k=f[m];Dt(n,k,yn(k,m,o.legends,c,l,a,i))}u.forEach(m=>{const k=m.bounds;if(k.equals(m._bounds)||(m.bounds=m._bounds,n.dirty(m),m.bounds=k,n.dirty(m)),o.autosize&&(o.autosize.type===Lt||o.autosize.type===Tt||o.autosize.type===zt))switch(m.orient){case D:case B:s.add(k.x1,0).add(k.x2,0);break;case N:case H:s.add(0,k.y1).add(0,k.y2)}else s.union(k)})}s.union(c).union(l),d&&s.union(kn(n,d,a,i,s)),t.clip&&s.set(0,0,t.width||0,t.height||0),pn(n,t,s,o)}function pn(n,t,o,r){const a=r.autosize||{},i=a.type;if(n._autosize<1||!i)return;let s=n._width,c=n._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-o.x1)),d=Math.max(0,t.height||0),y=Math.max(0,Math.ceil(-o.y1));const h=Math.max(0,Math.ceil(o.x2-l)),x=Math.max(0,Math.ceil(o.y2-d));if(a.contains===Jt){const b=n.padding();s-=b.left+b.right,c-=b.top+b.bottom}i===at?(u=0,y=0,l=s,d=c):i===Lt?(l=Math.max(0,s-u-h),d=Math.max(0,c-y-x)):i===Tt?(l=Math.max(0,s-u-h),c=d+y+x):i===zt?(s=l+u+h,d=Math.max(0,c-y-x)):i===Qt&&(s=l+u+h,c=d+y+x),n._resizeView(s,c,l,d,[u,y],a.resize)}const Ln=Object.freeze(Object.defineProperty({__proto__:null,bound:Ot,identifier:it,mark:It,overlap:Ft,render:St,viewlayout:Bt},Symbol.toStringTag,{value:"Module"}));export{Ln as v};
