import{T as y}from"./vega-dataflow-7e3fa937.js";import{u as k,d as x,z as d,b as F,r as v,k as M}from"./vega-util-7f144c9d.js";import{f as D,a as w,b as T,c as O,d as P,e as S,g as j}from"./d3-force-99d3a5f1.js";const p={center:w,collide:T,nbody:O,link:P,x:S,y:j},c="forces",u=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],z=["static","iterations"],h=["x","y","vx","vy"];function l(e){y.call(this,null,e)}l.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:h}]};k(l,y,{transform(e,a){var t=this.value,n=a.changed(a.ADD_REM),o=e.modified(u),r=e.iterations||300;if(t?(n&&(a.modifies("index"),t.nodes(a.source)),(o||a.changed(a.MOD))&&g(t,e,0,a)):(this.value=t=A(a.source,e),t.on("tick",C(a.dataflow,this)),e.static||(n=!0,t.tick()),a.modifies("index")),o||n||e.modified(z)||a.changed()&&e.restart){if(t.alpha(Math.max(t.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(t.alphaMin(),1/r)),e.static)for(t.stop();--r>=0;)t.tick();else if(t.stopped()&&t.restart(),!n)return a.StopPropagation}return this.finish(e,a)},finish(e,a){const t=a.dataflow;for(let i=this._argops,s=0,b=i.length,m;s<b;++s)if(m=i[s],!(m.name!==c||m.op._argval.force!=="link")){for(var n=m.op._argops,o=0,r=n.length,f;o<r;++o)if(n[o].name==="links"&&(f=n[o].op.source)){t.pulse(f,t.changeset().reflow());break}}return a.reflow(e.modified()).modifies(h)}});function C(e,a){return()=>e.touch(a).run()}function A(e,a){const t=D(e),n=t.stop,o=t.restart;let r=!1;return t.stopped=()=>r,t.restart=()=>(r=!1,o()),t.stop=()=>(r=!0,n()),g(t,a,!0).on("end",()=>r=!0)}function g(e,a,t,n){var o=x(a.forces),r,f,i,s;for(r=0,f=u.length;r<f;++r)i=u[r],i!==c&&a.modified(i)&&e[i](a[i]);for(r=0,f=o.length;r<f;++r)s=c+r,i=t||a.modified(c,r)?E(o[r]):n&&B(o[r],n)?e.force(s):null,i&&e.force(s,i);for(f=e.numForces||0;r<f;++r)e.force(c+r,null);return e.numForces=o.length,e}function B(e,a){var t,n;for(t in e)if(d(n=e[t])&&a.modified(F(n)))return 1;return 0}function E(e){var a,t;v(p,e.force)||M("Unrecognized force: "+e.force),a=p[e.force]();for(t in e)d(a[t])&&L(a[t],e[t],e);return a}function L(e,a,t){e(d(a)?n=>a(n,t):a)}const Y=Object.freeze(Object.defineProperty({__proto__:null,force:l},Symbol.toStringTag,{value:"Module"}));export{Y as f};
