import{k as p,r as N,w as h,V as P,x as st,y as ut,B as ct,C as R,F as ft,G as A,a0 as lt,a1 as dt,a2 as mt,a4 as ht,q as gt,J as pt,Q as xt,Z as wt,v as vt,a5 as yt,X as bt,a7 as St,l as Nt,g as At,R as Ft,S as $t,T as Et,U as Pt,ab as Rt,ac as It,ad as Dt,ae as Mt,$ as y,e as L,a6 as j,z as O,p as Lt,t as Tt,d as b}from"./vega-util-7f144c9d.js";import{c as qt,L as x,C as Bt,F as Gt,p as Xt,a as Ct}from"./vega-expression-6ae7ab31.js";import{s as z,g as Vt,A as zt,x as kt}from"./vega-scale-1e252b35.js";import{b as H}from"./vega-dataflow-7e3fa937.js";import{G as Ut,K as Yt,F as jt,B as W,t as Ot}from"./vega-scenegraph-d3a31be7.js";import{s as T,a as Ht,b as Wt,c as Zt,d as Jt}from"./vega-selections-65026350.js";import{r as Kt,d as Qt,c as _t,f as tn,h as nn,g as en,i as rn,k as an,q as on,l as sn,H as un,G as cn,I as fn}from"./vega-statistics-100b599b.js";import{m as ln,n as dn,h as mn,i as hn,j as gn,w as pn,p as xn,e as wn,o as vn}from"./vega-time-a8429f91.js";import{r as Z,l as yn,a as bn,h as Sn}from"./d3-color-26a9142b.js";import{r as Nn}from"./d3-array-ee3dc224.js";import{g as An,a as Fn,b as $n}from"./d3-geo-55025d8a.js";function J(t){const n=this.context.data[t];return n?n.values.value:[]}function En(t,n,e){const r=this.context.data[t]["index:"+n],a=r?r.value.get(e):void 0;return a&&a.count}function Pn(t,n){const e=this.context.dataflow,r=this.context.data[t],a=r.input;return e.pulse(a,e.changeset().remove(j).insert(n)),1}function Rn(t,n,e){if(t){const r=this.context.dataflow,a=t.mark.source;r.pulse(a,r.changeset().encode(t,n))}return e!==void 0?e:t}const w=t=>function(n,e){return this.context.dataflow.locale()[t](e)(n)},In=w("format"),K=w("timeFormat"),Dn=w("utcFormat"),Mn=w("timeParse"),Ln=w("utcParse"),v=new Date(2e3,0,1);function F(t,n,e){return!Number.isInteger(t)||!Number.isInteger(n)?"":(v.setYear(2e3),v.setMonth(t),v.setDate(n),K.call(this,v,e))}function Tn(t){return F.call(this,t,1,"%B")}function qn(t){return F.call(this,t,1,"%b")}function Bn(t){return F.call(this,0,2+t,"%A")}function Gn(t){return F.call(this,0,2+t,"%a")}const Xn=":",Cn="@",I="%",Q="$";function q(t,n,e,r){n[0].type!==x&&p("First argument to data functions must be a string literal.");const a=n[0].value,i=Xn+a;if(!N(i,r))try{r[i]=e.getData(a).tuplesRef()}catch{}}function Vn(t,n,e,r){n[0].type!==x&&p("First argument to indata must be a string literal."),n[1].type!==x&&p("Second argument to indata must be a string literal.");const a=n[0].value,i=n[1].value,o=Cn+i;N(o,r)||(r[o]=e.getData(a).indataRef(e,i))}function l(t,n,e,r){if(n[0].type===x)k(e,r,n[0].value);else for(t in e.scales)k(e,r,t)}function k(t,n,e){const r=I+e;if(!N(n,r))try{n[r]=t.scaleRef(e)}catch{}}function m(t,n){if(O(t))return t;if(A(t)){const e=n.scales[t];return e&&zt(e.value)?e.value:void 0}}function zn(t,n,e){n.__bandwidth=a=>a&&a.bandwidth?a.bandwidth():0,e._bandwidth=l,e._range=l,e._scale=l;const r=a=>"_["+(a.type===x?y(I+a.value):y(I)+"+"+t(a))+"]";return{_bandwidth:a=>`this.__bandwidth(${r(a[0])})`,_range:a=>`${r(a[0])}.range()`,_scale:a=>`${r(a[0])}(${t(a[1])})`}}function B(t,n){return function(e,r,a){if(e){const i=m(e,(a||this).context);return i&&i.path[t](r)}else return n(r)}}const kn=B("area",An),Un=B("bounds",Fn),Yn=B("centroid",$n);function jn(t){const n=this.context.group;let e=!1;if(n)for(;t;){if(t===n){e=!0;break}t=t.mark.group}return e}function G(t,n,e){try{t[n].apply(t,["EXPRESSION"].concat([].slice.call(e)))}catch(r){t.warn(r)}return e[e.length-1]}function On(){return G(this.context.dataflow,"warn",arguments)}function Hn(){return G(this.context.dataflow,"info",arguments)}function Wn(){return G(this.context.dataflow,"debug",arguments)}function E(t){const n=t/255;return n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}function D(t){const n=Z(t),e=E(n.r),r=E(n.g),a=E(n.b);return .2126*e+.7152*r+.0722*a}function Zn(t,n){const e=D(t),r=D(n),a=Math.max(e,r),i=Math.min(e,r);return(a+.05)/(i+.05)}function Jn(){const t=[].slice.call(arguments);return t.unshift({}),L(...t)}function _(t,n){return t===n||t!==t&&n!==n?!0:h(t)?h(n)&&t.length===n.length?Kn(t,n):!1:R(t)&&R(n)?tt(t,n):!1}function Kn(t,n){for(let e=0,r=t.length;e<r;++e)if(!_(t[e],n[e]))return!1;return!0}function tt(t,n){for(const e in t)if(!_(t[e],n[e]))return!1;return!0}function U(t){return n=>tt(t,n)}function Qn(t,n,e,r,a,i){const o=this.context.dataflow,c=this.context.data[t],s=c.input,f=o.stamp();let d=c.changes,g,$;if(o._trigger===!1||!(s.value.length||n||r))return 0;if((!d||d.stamp<f)&&(c.changes=d=o.changeset(),d.stamp=f,o.runAfter(()=>{c.modified=!0,o.pulse(s,d).run()},!0,1)),e&&(g=e===!0?j:h(e)||H(e)?e:U(e),d.remove(g)),n&&d.insert(n),r&&(g=U(r),s.value.some(g)?d.remove(g):d.insert(r)),a)for($ in i)d.modify(a,$,i[$]);return 1}function _n(t){const n=t.touches,e=n[0].clientX-n[1].clientX,r=n[0].clientY-n[1].clientY;return Math.hypot(e,r)}function te(t){const n=t.touches;return Math.atan2(n[0].clientY-n[1].clientY,n[0].clientX-n[1].clientX)}const Y={};function ne(t,n){const e=Y[n]||(Y[n]=Lt(n));return h(t)?t.map(e):e(t)}function X(t){return h(t)||ArrayBuffer.isView(t)?t:null}function C(t){return X(t)||(A(t)?t:null)}function ee(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return X(t).join(...e)}function re(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return C(t).indexOf(...e)}function ae(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return C(t).lastIndexOf(...e)}function ie(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return C(t).slice(...e)}function oe(t,n,e){return O(e)&&p("Function argument passed to replace."),String(t).replace(n,e)}function se(t){return X(t).slice().reverse()}function ue(t,n,e){return kt(t||0,n||0,e||0)}function ce(t,n){const e=m(t,(n||this).context);return e&&e.bandwidth?e.bandwidth():0}function fe(t,n){const e=m(t,(n||this).context);return e?e.copy():void 0}function le(t,n){const e=m(t,(n||this).context);return e?e.domain():[]}function de(t,n,e){const r=m(t,(e||this).context);return r?h(n)?(r.invertRange||r.invert)(n):(r.invert||r.invertExtent)(n):void 0}function me(t,n){const e=m(t,(n||this).context);return e&&e.range?e.range():[]}function he(t,n,e){const r=m(t,(e||this).context);return r?r(n):void 0}function ge(t,n,e,r,a){t=m(t,(a||this).context);const i=Ut(n,e);let o=t.domain(),c=o[0],s=P(o),f=Tt;return s-c?f=Vt(t,c,s):t=(t.interpolator?z("sequential")().interpolator(t.interpolator()):z("linear")().interpolate(t.interpolate()).range(t.range())).domain([c=0,s=1]),t.ticks&&(o=t.ticks(+r||15),c!==o[0]&&o.unshift(c),s!==P(o)&&o.push(s)),o.forEach(d=>i.stop(f(d),t(d))),i}function pe(t,n,e){const r=m(t,(e||this).context);return function(a){return r?r.path.context(a)(n):""}}function xe(t){let n=null;return function(e){return e?Yt(e,n=n||jt(t)):t}}const nt=t=>t.data;function et(t,n){const e=J.call(n,t);return e.root&&e.root.lookup||{}}function we(t,n,e){const r=et(t,this),a=r[n],i=r[e];return a&&i?a.path(i).map(nt):void 0}function ve(t,n){const e=et(t,this)[n];return e?e.ancestors().map(nt):void 0}const rt=()=>typeof window<"u"&&window||null;function ye(){const t=rt();return t?t.screen:{}}function be(){const t=rt();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]}function Se(){const t=this.context.dataflow,n=t.container&&t.container();return n?[n.clientWidth,n.clientHeight]:[void 0,void 0]}function at(t,n,e){if(!t)return[];const[r,a]=t,i=new W().set(r[0],r[1],a[0],a[1]),o=e||this.context.dataflow.scenegraph().root;return Ot(o,i,Ne(n))}function Ne(t){let n=null;if(t){const e=b(t.marktype),r=b(t.markname);n=a=>(!e.length||e.some(i=>a.marktype===i))&&(!r.length||r.some(i=>a.name===i))}return n}function Ae(t,n,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;t=b(t);const a=t[t.length-1];return a===void 0||Math.hypot(a[0]-n,a[1]-e)>r?[...t,[n,e]]:t}function Fe(t){return b(t).reduce((n,e,r)=>{let[a,i]=e;return n+=r==0?`M ${a},${i} `:r===t.length-1?" Z":`L ${a},${i} `},"")}function $e(t,n,e){const{x:r,y:a,mark:i}=e,o=new W().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[s,f]of n)s<o.x1&&(o.x1=s),s>o.x2&&(o.x2=s),f<o.y1&&(o.y1=f),f>o.y2&&(o.y2=f);return o.translate(r,a),at([[o.x1,o.y1],[o.x2,o.y2]],t,i).filter(s=>Ee(s.x,s.y,n))}function Ee(t,n,e){let r=0;for(let a=0,i=e.length-1;a<e.length;i=a++){const[o,c]=e[i],[s,f]=e[a];f>n!=c>n&&t<(o-s)*(n-f)/(c-f)+s&&r++}return r&1}const S={random(){return Kt()},cumulativeNormal:Qt,cumulativeLogNormal:_t,cumulativeUniform:tn,densityNormal:nn,densityLogNormal:en,densityUniform:rn,quantileNormal:an,quantileLogNormal:on,quantileUniform:sn,sampleNormal:un,sampleLogNormal:cn,sampleUniform:fn,isArray:h,isBoolean:st,isDate:ut,isDefined(t){return t!==void 0},isNumber:ct,isObject:R,isRegExp:ft,isString:A,isTuple:H,isValid(t){return t!=null&&t===t},toBoolean:lt,toDate(t){return dt(t)},toNumber:mt,toString:ht,indexof:re,join:ee,lastindexof:ae,replace:oe,reverse:se,slice:ie,flush:gt,lerp:pt,merge:Jn,pad:xt,peek:P,pluck:ne,span:wt,inrange:vt,truncate:yt,rgb:Z,lab:yn,hcl:bn,hsl:Sn,luminance:D,contrast:Zn,sequence:Nn,format:In,utcFormat:Dn,utcParse:Ln,utcOffset:ln,utcSequence:dn,timeFormat:K,timeParse:Mn,timeOffset:mn,timeSequence:hn,timeUnitSpecifier:gn,monthFormat:Tn,monthAbbrevFormat:qn,dayFormat:Bn,dayAbbrevFormat:Gn,quarter:bt,utcquarter:St,week:pn,utcweek:xn,dayofyear:wn,utcdayofyear:vn,warn:On,info:Hn,debug:Wn,extent(t){return Nt(t)},inScope:jn,intersect:at,clampRange:At,pinchDistance:_n,pinchAngle:te,screen:ye,containerSize:Se,windowSize:be,bandspace:ue,setdata:Pn,pathShape:xe,panLinear:Ft,panLog:$t,panPow:Et,panSymlog:Pt,zoomLinear:Rt,zoomLog:It,zoomPow:Dt,zoomSymlog:Mt,encode:Rn,modify:Qn,lassoAppend:Ae,lassoPath:Fe,intersectLasso:$e},Pe=["view","item","group","xy","x","y"],Re="event.vega.",it="this.",V={},ot={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${y(Q+t)}]`,functions:Ie,constants:Bt,visitors:V},M=qt(ot);function Ie(t){const n=Gt(t);Pe.forEach(e=>n[e]=Re+e);for(const e in S)n[e]=it+e;return L(n,zn(t,S,V)),n}function u(t,n,e){return arguments.length===1?S[t]:(S[t]=n,e&&(V[t]=e),M&&(M.functions[t]=it+t),this)}u("bandwidth",ce,l);u("copy",fe,l);u("domain",le,l);u("range",me,l);u("invert",de,l);u("scale",he,l);u("gradient",ge,l);u("geoArea",kn,l);u("geoBounds",Un,l);u("geoCentroid",Yn,l);u("geoShape",pe,l);u("indata",En,Vn);u("data",J,q);u("treePath",we,q);u("treeAncestors",ve,q);u("vlSelectionTest",Ht,T);u("vlSelectionIdTest",Wt,T);u("vlSelectionResolve",Zt,T);u("vlSelectionTuples",Jt);function ke(t,n){const e={};let r;try{t=A(t)?t:y(t)+"",r=Xt(t)}catch{p("Expression parse error: "+t)}r.visit(i=>{if(i.type!==Ct)return;const o=i.callee.name,c=ot.visitors[o];c&&c(o,i.arguments,n,e)});const a=M(r);return a.globals.forEach(i=>{const o=Q+i;!N(e,o)&&n.getSignal(i)&&(e[o]=n.signalRef(i))}),{$expr:L({code:a.code},n.options.ast?{ast:r}:null),$fields:a.fields,$params:e}}export{u as e,S as f,ke as p};
