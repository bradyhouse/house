import{i as b,T as h,f as me,s as X}from"./vega-dataflow-7e3fa937.js";import{t as R,d as ce,v as ue,e as he,S as A,l as ge,f as pe,G as ve,g as Me,h as ye,s as Se,j as z,L as C,k as Y,T as ke,U as be,O as $,m as De,n as G,P as q,o as xe,p as Oe,B as V,r as B,a as Q,i as ze,u as we,w as T,x as Ae,c as Ce,y as Le,Q as Re,z as Pe,q as Ee,b as Ie,D as Te}from"./vega-scale-1e252b35.js";import{u as y,o as Z,a3 as Ne,w,k as O,n as k,z as D,i as Fe,V as x,P as H,G as Ue,ac as je,ad as N,ae as Xe,ab as Ye,$ as $e}from"./vega-util-7f144c9d.js";import{s as Ge,r as J}from"./d3-array-ee3dc224.js";import{i as qe}from"./d3-scale-7849a529.js";import{b as Ve,a as Be}from"./d3-interpolate-5b94efd8.js";function K(e){h.call(this,null,e)}y(K,h,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=this.value,o=e.scale,s=e.count==null?e.values?e.values.length:10:e.count,r=R(o,s,e.minstep),l=e.format||ce(n,o,r,e.formatSpecifier,e.formatType,!!e.values),f=e.values?ue(o,e.values,r):he(o,r);return a&&(i.rem=a),a=f.map((d,m)=>b({index:m/(f.length-1||1),value:d,label:l(d)})),e.extra&&a.length&&a.push(b({index:-1,extra:{value:a[0].value},label:""})),i.source=a,i.add=a,this.value=a,i}});function W(e){h.call(this,null,e)}function Qe(){return b({})}function Ze(e){const t=Z().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}y(W,h,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.item||Qe,o=e.key||me,s=this.value;return w(i.encode)&&(i.encode=null),s&&(e.modified("key")||t.modified(o))&&O("DataJoin does not support modified key function or fields."),s||(t=t.addAll(),this.value=s=Ze(o)),t.visit(t.ADD,r=>{const l=o(r);let f=s.get(l);f?f.exit?(s.empty--,i.add.push(f)):i.mod.push(f):(f=a(r),s.set(l,f),i.add.push(f)),f.datum=r,f.exit=!1}),t.visit(t.MOD,r=>{const l=o(r),f=s.get(l);f&&(f.datum=r,i.mod.push(f))}),t.visit(t.REM,r=>{const l=o(r),f=s.get(l);r===f.datum&&!f.exit&&(i.rem.push(f),f.exit=!0,++s.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&s.empty>n.cleanThreshold)&&n.runAfter(s.clean),i}});function _(e){h.call(this,null,e)}y(_,h,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,a=e.encoders,o=t.encode;if(w(o))if(n.changed()||o.every(m=>a[m]))o=o[0],n.encode=null;else return t.StopPropagation;var s=o==="enter",r=a.update||k,l=a.enter||k,f=a.exit||k,d=(o&&!s?a[o]:r)||k;if(t.changed(t.ADD)&&(t.visit(t.ADD,m=>{l(m,e),r(m,e)}),n.modifies(l.output),n.modifies(r.output),d!==k&&d!==r&&(t.visit(t.ADD,m=>{d(m,e)}),n.modifies(d.output))),t.changed(t.REM)&&f!==k&&(t.visit(t.REM,m=>{f(m,e)}),n.modifies(f.output)),s||d!==k){const m=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(m,c=>{const g=l(c,e)||i;(d(c,e)||g)&&n.mod.push(c)}),n.mod.length&&n.modifies(l.output)):t.visit(m,c=>{(d(c,e)||i)&&n.mod.push(c)}),n.mod.length&&n.modifies(d.output)}return n.changed()?n:t.StopPropagation}});function ee(e){h.call(this,[],e)}y(ee,h,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=this.value,o=e.type||A,s=e.scale,r=+e.limit,l=R(s,e.count==null?5:e.count,e.minstep),f=!!e.values||o===A,d=e.format||ge(n,s,l,o,e.formatSpecifier,e.formatType,f),m=e.values||pe(s,l),c,g,u,M,S;return a&&(i.rem=a),o===A?(r&&m.length>r?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),a=m.slice(0,r-1),S=!0):a=m,D(u=e.size)?(!e.values&&s(a[0])===0&&(a=a.slice(1)),M=a.reduce((p,v)=>Math.max(p,u(v,e)),0)):u=Fe(M=u||8),a=a.map((p,v)=>b({index:v,label:d(p,v,a),value:p,offset:M,size:u(p,e)})),S&&(S=m[a.length],a.push(b({index:a.length,label:`â€¦${m.length-a.length} entries`,value:S,offset:M,size:u(S,e)})))):o===ve?(c=s.domain(),g=Me(s,c[0],x(c)),m.length<3&&!e.values&&c[0]!==x(c)&&(m=[c[0],x(c)]),a=m.map((p,v)=>b({index:v,label:d(p,v,m),value:p,perc:g(p)}))):(u=m.length-1,g=ye(s),a=m.map((p,v)=>b({index:v,label:d(p,v,m),value:p,perc:v?g(p):0,perc2:v===u?1:g(m[v+1])}))),i.source=a,i.add=a,this.value=a,i}});const He=e=>e.source.x,Je=e=>e.source.y,Ke=e=>e.target.x,We=e=>e.target.y;function P(e){h.call(this,{},e)}P.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};y(P,h,{transform(e,t){var n=e.sourceX||He,i=e.sourceY||Je,a=e.targetX||Ke,o=e.targetY||We,s=e.as||"path",r=e.orient||"vertical",l=e.shape||"line",f=F.get(l+"-"+r)||F.get(l);return f||O("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,d=>{d[s]=f(n(d),i(d),a(d),o(d))}),t.reflow(e.modified()).modifies(s)}});const te=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,_e=(e,t,n,i)=>te(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),ne=(e,t,n,i)=>{var a=n-e,o=i-t,s=Math.hypot(a,o)/2,r=180*Math.atan2(o,a)/Math.PI;return"M"+e+","+t+"A"+s+","+s+" "+r+" 0 1 "+n+","+i},et=(e,t,n,i)=>ne(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),ae=(e,t,n,i)=>{const a=n-e,o=i-t,s=.2*(a+o),r=.2*(o-a);return"M"+e+","+t+"C"+(e+s)+","+(t+r)+" "+(n+r)+","+(i-s)+" "+n+","+i},tt=(e,t,n,i)=>ae(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),nt=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,at=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,it=(e,t,n,i)=>{const a=Math.cos(e),o=Math.sin(e),s=Math.cos(n),r=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*a+","+t*o+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*s+","+t*r+"L"+i*s+","+i*r},ot=(e,t,n,i)=>{const a=(e+n)/2;return"M"+e+","+t+"C"+a+","+t+" "+a+","+i+" "+n+","+i},rt=(e,t,n,i)=>{const a=(t+i)/2;return"M"+e+","+t+"C"+e+","+a+" "+n+","+a+" "+n+","+i},st=(e,t,n,i)=>{const a=Math.cos(e),o=Math.sin(e),s=Math.cos(n),r=Math.sin(n),l=(t+i)/2;return"M"+t*a+","+t*o+"C"+l*a+","+l*o+" "+l*s+","+l*r+" "+i*s+","+i*r},F=Z({line:te,"line-radial":_e,arc:ne,"arc-radial":et,curve:ae,"curve-radial":tt,"orthogonal-horizontal":nt,"orthogonal-vertical":at,"orthogonal-radial":it,"diagonal-horizontal":ot,"diagonal-vertical":rt,"diagonal-radial":st});function E(e){h.call(this,null,e)}E.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};y(E,h,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],a=n[1],o=e.field||H,s=e.startAngle||0,r=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,f=l.map(o),d=f.length,m=s,c=(r-s)/Ge(f),g=J(d),u,M,S;for(e.sort&&g.sort((p,v)=>f[p]-f[v]),u=0;u<d;++u)S=f[g[u]],M=l[g[u]],M[i]=m,M[a]=m+=S*c;return this.value=f,t.reflow(e.modified()).modifies(n)}});const lt=5;function ft(e){const t=e.type;return!e.bins&&(t===C||t===q||t===G)}function ie(e){return Y(e)&&e!==z}const dt=Ne(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function oe(e){h.call(this,null,e),this.modified(!0)}y(oe,h,{transform(e,t){var n=t.dataflow,i=this.value,a=mt(e);(!i||a!==i.type)&&(this.value=i=Se(a)());for(a in e)if(!dt[a]){if(a==="padding"&&ie(i.type))continue;D(i[a])?i[a](e[a]):n.warn("Unsupported scale property: "+a)}return vt(i,e,pt(i,e,ut(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function mt(e){var t=e.type,n="",i;return t===z?z+"-"+C:(ct(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?z+"-":i===3?Te+"-":""),(n+t||C).toLowerCase())}function ct(e){const t=e.type;return Y(t)&&t!==ke&&t!==be&&(e.scheme||e.range&&e.range.length&&e.range.every(Ue))}function ut(e,t,n){const i=ht(e,t.domainRaw,n);if(i>-1)return i;var a=t.domain,o=e.type,s=t.zero||t.zero===void 0&&ft(e),r,l;if(!a)return 0;if(ie(o)&&t.padding&&a[0]!==x(a)&&(a=gt(o,a,t.range,t.padding,t.exponent,t.constant)),(s||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(r=(a=a.slice()).length-1||1,s&&(a[0]>0&&(a[0]=0),a[r]<0&&(a[r]=0)),t.domainMin!=null&&(a[0]=t.domainMin),t.domainMax!=null&&(a[r]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const f=l>a[r]?r+1:l<a[0]?0:r;f!==r&&n.warn("Scale domainMid exceeds domain min or max.",l),a.splice(f,0,l)}return e.domain(re(o,a,n)),o===$&&e.unknown(t.domainImplicit?qe:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&R(e,t.nice)||null),a.length}function ht(e,t,n){return t?(e.domain(re(e.type,t,n)),t.length):-1}function gt(e,t,n,i,a,o){var s=Math.abs(x(n)-n[0]),r=s/(s-2*i),l=e===De?je(t,null,r):e===G?N(t,null,r,.5):e===q?N(t,null,r,a||1):e===xe?Xe(t,null,r,o||1):Ye(t,null,r);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function re(e,t,n){if(Oe(e)){var i=Math.abs(t.reduce((a,o)=>a+(o<0?-1:o>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+$e(t))}return t}function pt(e,t,n){let i=t.bins;if(i&&!w(i)){const a=e.domain(),o=a[0],s=x(a),r=i.step;let l=i.start==null?o:i.start,f=i.stop==null?s:i.stop;r||O("Scale bins parameter missing step property."),l<o&&(l=r*Math.ceil(o/r)),f>s&&(f=r*Math.floor(s/r)),i=J(l,f+r/2,r)}return i?e.bins=i:e.bins&&delete e.bins,e.type===V&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function vt(e,t,n){var i=e.type,a=t.round||!1,o=t.range;if(t.rangeStep!=null)o=Mt(i,t,n);else if(t.scheme&&(o=yt(i,t,n),D(o))){if(e.interpolator)return e.interpolator(o);O(`Scale type ${i} does not support interpolating color schemes.`)}if(o&&B(i))return e.interpolator(Q(L(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(ze(t.interpolate,t.interpolateGamma)):D(e.round)?e.round(a):D(e.rangeRound)&&e.interpolate(a?Ve:Be),o&&e.range(L(o,t.reverse))}function Mt(e,t,n){e!==we&&e!==T&&O("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,a=e===T?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Ae(n,a,i)]}function yt(e,t,n){var i=t.schemeExtent,a,o;return w(t.scheme)?o=Q(t.scheme,t.interpolate,t.interpolateGamma):(a=t.scheme.toLowerCase(),o=Ce(a),o||O(`Unrecognized scheme name: ${t.scheme}`)),n=e===Le?n+1:e===V?n-1:e===Re||e===Pe?+t.schemeCount||lt:n,B(e)?U(o,i,t.reverse):D(o)?Ee(U(o,i),n):e===$?o:o.slice(0,n)}function U(e,t,n){return D(e)&&(t||n)?Ie(e,L(t||[0,1],n)):e}function L(e,t){return t?e.slice().reverse():e}function se(e){h.call(this,null,e)}y(se,h,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(X(e.sort)),this.modified(n),t}});const j="zero",le="center",fe="normalize",de=["y0","y1"];function I(e){h.call(this,null,e)}I.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:j,values:[j,le,fe]},{name:"as",type:"string",array:!0,length:2,default:de}]};y(I,h,{transform(e,t){var n=e.as||de,i=n[0],a=n[1],o=X(e.sort),s=e.field||H,r=e.offset===le?St:e.offset===fe?kt:bt,l,f,d,m;for(l=Dt(t.source,e.groupby,o,s),f=0,d=l.length,m=l.max;f<d;++f)r(l[f],m,s,i,a);return t.reflow(e.modified()).modifies(n)}});function St(e,t,n,i,a){for(var o=(t-e.sum)/2,s=e.length,r=0,l;r<s;++r)l=e[r],l[i]=o,l[a]=o+=Math.abs(n(l))}function kt(e,t,n,i,a){for(var o=1/e.sum,s=0,r=e.length,l=0,f=0,d;l<r;++l)d=e[l],d[i]=s,d[a]=s=o*(f+=Math.abs(n(d)))}function bt(e,t,n,i,a){for(var o=0,s=0,r=e.length,l=0,f,d;l<r;++l)d=e[l],f=+n(d),f<0?(d[i]=s,d[a]=s+=f):(d[i]=o,d[a]=o+=f)}function Dt(e,t,n,i){var a=[],o=M=>M(d),s,r,l,f,d,m,c,g,u;if(t==null)a.push(e.slice());else for(s={},r=0,l=e.length;r<l;++r)d=e[r],m=t.map(o),c=s[m],c||(s[m]=c=[],a.push(c)),c.push(d);for(m=0,u=0,f=a.length;m<f;++m){for(c=a[m],r=0,g=0,l=c.length;r<l;++r)g+=Math.abs(i(c[r]));c.sum=g,g>u&&(u=g),n&&c.sort(n)}return a.max=u,a}const Lt=Object.freeze(Object.defineProperty({__proto__:null,axisticks:K,datajoin:W,encode:_,legendentries:ee,linkpath:P,pie:E,scale:oe,sortitems:se,stack:I},Symbol.toStringTag,{value:"Module"}));export{Lt as e};
