import{d as K}from"./vega-canvas-6169e3a3.js";import{T as X}from"./vega-dataflow-7e3fa937.js";import{u as L,k as Q,z as U,i as V,l as Z}from"./vega-util-7f144c9d.js";import{s as $}from"./vega-scale-1e252b35.js";import{r as j}from"./vega-statistics-100b599b.js";var A=Math.PI/180,C=64,q=2048;function _(){var e=[256,256],t,o,y,f,h,a,c,p=Y,z=[],s=Math.random,i={};i.layout=function(){for(var r=l(K()),n=at((e[0]>>5)*e[1]),u=null,d=z.length,S=-1,w=[],M=z.map(m=>({text:t(m),font:o(m),style:f(m),weight:h(m),rotate:a(m),size:~~(y(m)+1e-14),padding:c(m),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:m})).sort((m,v)=>v.size-m.size);++S<d;){var x=M[S];x.x=e[0]*(s()+.5)>>1,x.y=e[1]*(s()+.5)>>1,tt(r,x,M,S),x.hasText&&g(n,x,u)&&(w.push(x),u?rt(u,x):u=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return w};function l(r){r.width=r.height=1;var n=Math.sqrt(r.getContext("2d").getImageData(0,0,1,1).data.length>>2);r.width=(C<<5)/n,r.height=q/n;var u=r.getContext("2d");return u.fillStyle=u.strokeStyle="red",u.textAlign="center",{context:u,ratio:n}}function g(r,n,u){for(var d=n.x,S=n.y,w=Math.sqrt(e[0]*e[0]+e[1]*e[1]),M=p(e),x=s()<.5?1:-1,m=-x,v,W,T;(v=M(m+=x))&&(W=~~v[0],T=~~v[1],!(Math.min(Math.abs(W),Math.abs(T))>=w));)if(n.x=d+W,n.y=S+T,!(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])&&(!u||!et(n,r,e[0]))&&(!u||nt(n,u))){for(var D=n.sprite,R=n.width>>5,I=e[0]>>5,P=n.x-(R<<4),B=P&127,H=32-B,J=n.y1-n.y0,F=(n.y+n.y0)*I+(P>>5),N,O=0;O<J;O++){N=0;for(var k=0;k<=R;k++)r[F+k]|=N<<H|(k<R?(N=D[O*R+k])>>>B:0);F+=I}return n.sprite=null,!0}return!1}return i.words=function(r){return arguments.length?(z=r,i):z},i.size=function(r){return arguments.length?(e=[+r[0],+r[1]],i):e},i.font=function(r){return arguments.length?(o=b(r),i):o},i.fontStyle=function(r){return arguments.length?(f=b(r),i):f},i.fontWeight=function(r){return arguments.length?(h=b(r),i):h},i.rotate=function(r){return arguments.length?(a=b(r),i):a},i.text=function(r){return arguments.length?(t=b(r),i):t},i.spiral=function(r){return arguments.length?(p=ot[r]||r,i):p},i.fontSize=function(r){return arguments.length?(y=b(r),i):y},i.padding=function(r){return arguments.length?(c=b(r),i):c},i.random=function(r){return arguments.length?(s=r,i):s},i}function tt(e,t,o,y){if(!t.sprite){var f=e.context,h=e.ratio;f.clearRect(0,0,(C<<5)/h,q/h);var a=0,c=0,p=0,z=o.length,s,i,l,g,r;for(--y;++y<z;){if(t=o[y],f.save(),f.font=t.style+" "+t.weight+" "+~~((t.size+1)/h)+"px "+t.font,s=f.measureText(t.text+"m").width*h,l=t.size<<1,t.rotate){var n=Math.sin(t.rotate*A),u=Math.cos(t.rotate*A),d=s*u,S=s*n,w=l*u,M=l*n;s=Math.max(Math.abs(d+M),Math.abs(d-M))+31>>5<<5,l=~~Math.max(Math.abs(S+w),Math.abs(S-w))}else s=s+31>>5<<5;if(l>p&&(p=l),a+s>=C<<5&&(a=0,c+=p,p=0),c+l>=q)break;f.translate((a+(s>>1))/h,(c+(l>>1))/h),t.rotate&&f.rotate(t.rotate*A),f.fillText(t.text,0,0),t.padding&&(f.lineWidth=2*t.padding,f.strokeText(t.text,0,0)),f.restore(),t.width=s,t.height=l,t.xoff=a,t.yoff=c,t.x1=s>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,a+=s}for(var x=f.getImageData(0,0,(C<<5)/h,q/h).data,m=[];--y>=0;)if(t=o[y],!!t.hasText){for(s=t.width,i=s>>5,l=t.y1-t.y0,g=0;g<l*i;g++)m[g]=0;if(a=t.xoff,a==null)return;c=t.yoff;var v=0,W=-1;for(r=0;r<l;r++){for(g=0;g<s;g++){var T=i*r+(g>>5),D=x[(c+r)*(C<<5)+(a+g)<<2]?1<<31-g%32:0;m[T]|=D,v|=D}v?W=r:(t.y0++,l--,r--,c++)}t.y1=t.y0+W,t.sprite=m.slice(0,(t.y1-t.y0)*i)}}}function et(e,t,o){o>>=5;for(var y=e.sprite,f=e.width>>5,h=e.x-(f<<4),a=h&127,c=32-a,p=e.y1-e.y0,z=(e.y+e.y0)*o+(h>>5),s,i=0;i<p;i++){s=0;for(var l=0;l<=f;l++)if((s<<c|(l<f?(s=y[i*f+l])>>>a:0))&t[z+l])return!0;z+=o}return!1}function rt(e,t){var o=e[0],y=e[1];t.x+t.x0<o.x&&(o.x=t.x+t.x0),t.y+t.y0<o.y&&(o.y=t.y+t.y0),t.x+t.x1>y.x&&(y.x=t.x+t.x1),t.y+t.y1>y.y&&(y.y=t.y+t.y1)}function nt(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Y(e){var t=e[0]/e[1];return function(o){return[t*(o*=.1)*Math.cos(o),o*Math.sin(o)]}}function it(e){var t=4,o=t*e[0]/e[1],y=0,f=0;return function(h){var a=h<0?-1:1;switch(Math.sqrt(1+4*a*h)-a&3){case 0:y+=o;break;case 1:f+=t;break;case 2:y-=o;break;default:f-=t;break}return[y,f]}}function at(e){for(var t=[],o=-1;++o<e;)t[o]=0;return t}function b(e){return typeof e=="function"?e:function(){return e}}var ot={archimedean:Y,rectangular:it};const G=["x","y","font","fontSize","fontStyle","fontWeight","angle"],ft=["text","font","rotate","fontSize","fontStyle","fontWeight"];function E(e){X.call(this,_(),e)}E.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:G}]};L(E,X,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&Q("Wordcloud size dimensions must be non-zero.");function o(r){const n=e[r];return U(n)&&t.modified(n.fields)}const y=e.modified();if(!(y||t.changed(t.ADD_REM)||ft.some(o)))return;const f=t.materialize(t.SOURCE).source,h=this.value,a=e.as||G;let c=e.fontSize||14,p;if(U(c)?p=e.fontSizeRange:c=V(c),p){const r=c,n=$("sqrt")().domain(Z(f,r)).range(p);c=u=>n(r(u))}f.forEach(r=>{r[a[0]]=NaN,r[a[1]]=NaN,r[a[3]]=0});const z=h.words(f).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(c).random(j).layout(),s=h.size(),i=s[0]>>1,l=s[1]>>1,g=z.length;for(let r=0,n,u;r<g;++r)n=z[r],u=n.datum,u[a[0]]=n.x+i,u[a[1]]=n.y+l,u[a[2]]=n.font,u[a[3]]=n.size,u[a[4]]=n.style,u[a[5]]=n.weight,u[a[6]]=n.rotate;return t.reflow(y).modifies(a)}});const ht=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:E},Symbol.toStringTag,{value:"Module"}));export{ht as w};
