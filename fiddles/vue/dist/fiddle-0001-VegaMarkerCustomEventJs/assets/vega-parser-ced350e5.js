import{$ as y,C as R,k as p,O as rn,d as w,r as T,e as v,V as ct,G as q,w as C,_ as on}from"./vega-util-7f144c9d.js";import{p as Y}from"./vega-functions-181775c3.js";import{e as sn}from"./vega-event-selector-ab613927.js";import{C as un,E as Ot,F as De,k as fn,H as se}from"./vega-scale-1e252b35.js";import{d as dn}from"./vega-dataflow-7e3fa937.js";function gn(t){return R(t)?t:{type:t||"pad"}}const ft=t=>+t||0,cn=t=>({top:t,bottom:t,left:t,right:t});function hn(t){return R(t)?t.signal?t:{top:ft(t.top),bottom:ft(t.bottom),left:ft(t.left),right:ft(t.right)}:cn(ft(t))}const z=t=>R(t)&&!C(t)?v({},t):{value:t};function ue(t,e,n,i){return n!=null?(R(n)&&!C(n)||C(n)&&n.length&&R(n[0])?t.update[e]=n:t[i||"enter"][e]={value:n},1):0}function L(t,e,n){for(const i in e)ue(t,i,e[i]);for(const i in n)ue(t,i,n[i],"update")}function ot(t,e,n){for(const i in e)n&&T(n,i)||(t[i]=v(t[i]||{},e[i]));return t}function it(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const Yt="mark",Nt="frame",Kt="scope",mn="axis",yn="axis-domain",pn="axis-grid",bn="axis-label",xn="axis-tick",kn="axis-title",Sn="legend",$n="legend-band",Rn="legend-entry",vn="legend-gradient",Le="legend-label",En="legend-symbol",On="legend-title",zn="title",Dn="title-text",Ln="title-subtitle";function wn(t,e,n,i,a){const l={},r={};let o,s,u,f;s="lineBreak",e==="text"&&a[s]!=null&&!it(s,t)&&At(l,s,a[s]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),f=n===Nt?a.group:n===Yt?v({},a.mark,a[e]):null;for(s in f)u=it(s,t)||(s==="fill"||s==="stroke")&&(it("fill",t)||it("stroke",t)),u||At(l,s,f[s]);w(i).forEach(d=>{const c=a.style&&a.style[d];for(const m in c)it(m,t)||At(l,m,c[m])}),t=v({},t);for(s in l)f=l[s],f.signal?(o=o||{})[s]=f:r[s]=f;return t.enter=v(r,t.enter),o&&(t.update=v(o,t.update)),t}function At(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const we=t=>q(t)?y(t):t.signal?`(${t.signal})`:Pe(t);function Dt(t){if(t.gradient!=null)return Cn(t);let e=t.signal?`(${t.signal})`:t.color?Pn(t.color):t.field!=null?Pe(t.field):t.value!==void 0?y(t.value):void 0;return t.scale!=null&&(e=Fn(t,e)),e===void 0&&(e=null),t.exponent!=null&&(e=`pow(${e},${St(t.exponent)})`),t.mult!=null&&(e+=`*${St(t.mult)}`),t.offset!=null&&(e+=`+${St(t.offset)}`),t.round&&(e=`round(${e})`),e}const kt=(t,e,n,i)=>`(${t}(${[e,n,i].map(Dt).join(",")})+'')`;function Pn(t){return t.c?kt("hcl",t.h,t.c,t.l):t.h||t.s?kt("hsl",t.h,t.s,t.l):t.l||t.a?kt("lab",t.l,t.a,t.b):t.r||t.g||t.b?kt("rgb",t.r,t.g,t.b):null}function Cn(t){const e=[t.start,t.stop,t.count].map(n=>n==null?null:y(n));for(;e.length&&ct(e)==null;)e.pop();return e.unshift(we(t.gradient)),`gradient(${e.join(",")})`}function St(t){return R(t)?"("+Dt(t)+")":t}function Pe(t){return Ce(R(t)?t:{datum:t})}function Ce(t){let e,n,i;if(t.signal)e="datum",i=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(i=t.parent,e+=".datum"):i=t.group}else t.datum?(e="datum",i=t.datum):p("Invalid field reference: "+y(t));return t.signal||(i=q(i)?on(i).map(y).join("]["):Ce(i)),e+"["+i+"]"}function Fn(t,e){const n=we(t.scale);return t.range!=null?e=`lerp(_range(${n}), ${+t.range})`:(e!==void 0&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(+t.band==1?"":"*"+St(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),e==null&&(e="0")),e}function Wn(t){let e="";return t.forEach(n=>{const i=Dt(n);e+=n.test?`(${n.test})?${i}:`:i}),ct(e)===":"&&(e+="null"),e}function Fe(t,e,n,i,a,l){const r={};l=l||{},l.encoders={$encode:r},t=wn(t,e,n,i,a.config);for(const o in t)r[o]=Tn(t[o],e,l,a);return l}function Tn(t,e,n,i){const a={},l={};for(const r in t)t[r]!=null&&(a[r]=An(jn(t[r]),i,n,l));return{$expr:{marktype:e,channels:a},$fields:Object.keys(l),$output:Object.keys(t)}}function jn(t){return C(t)?Wn(t):Dt(t)}function An(t,e,n,i){const a=Y(t,e);return a.$fields.forEach(l=>i[l]=1),v(n,a.$params),a.$expr}const Mn="outer",Bn=["value","update","init","react","bind"];function fe(t,e){p(t+' for "outer" push: '+y(e))}function We(t,e){const n=t.name;if(t.push===Mn)e.signals[n]||fe("No prior signal definition",n),Bn.forEach(i=>{t[i]!==void 0&&fe("Invalid property ",i)});else{const i=e.addSignal(n,t.value);t.react===!1&&(i.react=!1),t.bind&&e.addBinding(n,t.bind)}}function Vt(t,e,n,i){this.id=-1,this.type=t,this.value=e,this.params=n,i&&(this.parent=i)}function Lt(t,e,n,i){return new Vt(t,e,n,i)}function zt(t,e){return Lt("operator",t,e)}function g(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function ht(t,e){return e?{$field:t,$name:e}:{$field:t}}const Ut=ht("key");function de(t,e){return{$compare:t,$order:e}}function Vn(t,e){const n={$key:t};return e&&(n.$flat=!0),n}const Un="ascending",Gn="descending";function In(t){return R(t)?(t.order===Gn?"-":"+")+wt(t.op,t.field):""}function wt(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const Jt="scope",Gt="view";function O(t){return t&&t.signal}function Hn(t){return t&&t.expr}function $t(t){if(O(t))return!0;if(R(t)){for(const e in t)if($t(t[e]))return!0}return!1}function U(t,e){return t??e}function _(t){return t&&t.signal||t}const ge="timer";function mt(t,e){return(t.merge?qn:t.stream?Yn:t.type?Nn:p("Invalid stream specification: "+y(t)))(t,e)}function Xn(t){return t===Jt?Gt:t||Gt}function qn(t,e){const n=t.merge.map(a=>mt(a,e)),i=Qt({merge:n},t,e);return e.addStream(i).id}function Yn(t,e){const n=mt(t.stream,e),i=Qt({stream:n},t,e);return e.addStream(i).id}function Nn(t,e){let n;t.type===ge?(n=e.event(ge,t.throttle),t={between:t.between,filter:t.filter}):n=e.event(Xn(t.source),t.type);const i=Qt({stream:n},t,e);return Object.keys(i).length===1?n:e.addStream(i).id}function Qt(t,e,n){let i=e.between;return i&&(i.length!==2&&p('Stream "between" parameter must have 2 entries: '+y(e)),t.between=[mt(i[0],n),mt(i[1],n)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(Kn(e.marktype,e.markname,e.markrole)),e.source===Jt&&i.push("inScope(event.item)"),i.length&&(t.filter=Y("("+i.join(")&&(")+")",n).$expr),(i=e.throttle)!=null&&(t.throttle=+i),(i=e.debounce)!=null&&(t.debounce=+i),e.consume&&(t.consume=!0),t}function Kn(t,e,n){const i="event.item";return i+(t&&t!=="*"?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}const Jn={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Qn(t,e,n){const i=t.encode,a={target:n};let l=t.events,r=t.update,o=[];l||p("Signal update missing events specification."),q(l)&&(l=sn(l,e.isSubscope()?Jt:Gt)),l=w(l).filter(s=>s.signal||s.scale?(o.push(s),0):1),o.length>1&&(o=[Zn(o)]),l.length&&o.push(l.length>1?{merge:l}:l[0]),i!=null&&(r&&p("Signal encode and update are mutually exclusive."),r="encode(item(),"+y(i)+")"),a.update=q(r)?Y(r,e):r.expr!=null?Y(r.expr,e):r.value!=null?r.value:r.signal!=null?{$expr:Jn,$params:{$value:e.signalRef(r.signal)}}:p("Invalid signal update specification."),t.force&&(a.options={force:!0}),o.forEach(s=>e.addUpdate(v(_n(s,e),a)))}function _n(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):mt(t,e)}}function Zn(t){return{signal:"["+t.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function ti(t,e){const n=e.getSignal(t.name);let i=t.update;t.init&&(i?p("Signals can not include both init and update expressions."):(i=t.init,n.initonly=!0)),i&&(i=Y(i,e),n.update=i.$expr,n.params=i.$params),t.on&&t.on.forEach(a=>Qn(a,e,n.id))}const x=t=>(e,n,i)=>Lt(t,n,e||void 0,i),Te=x("aggregate"),ei=x("axisticks"),je=x("bound"),I=x("collect"),ce=x("compare"),ni=x("datajoin"),Ae=x("encode"),ii=x("expression"),ai=x("facet"),li=x("field"),ri=x("key"),oi=x("legendentries"),si=x("load"),ui=x("mark"),fi=x("multiextent"),di=x("multivalues"),gi=x("overlap"),ci=x("params"),Me=x("prefacet"),hi=x("projection"),mi=x("proxy"),yi=x("relay"),Be=x("render"),pi=x("scale"),tt=x("sieve"),bi=x("sortitems"),Ve=x("viewlayout"),xi=x("values");let ki=0;const Ue={min:"min",max:"max",count:"sum"};function Si(t,e){const n=t.type||"linear";un(n)||p("Unrecognized scale type: "+y(n)),e.addScale(t.name,{type:n,domain:void 0})}function $i(t,e){const n=e.getScale(t.name).params;let i;n.domain=Ge(t.domain,t,e),t.range!=null&&(n.range=He(t,e,n)),t.interpolate!=null&&Ci(t.interpolate,n),t.nice!=null&&(n.nice=Pi(t.nice)),t.bins!=null&&(n.bins=wi(t.bins,e));for(i in t)T(n,i)||i==="name"||(n[i]=A(t[i],e))}function A(t,e){return R(t)?t.signal?e.signalRef(t.signal):p("Unsupported object: "+y(t)):t}function Rt(t,e){return t.signal?e.signalRef(t.signal):t.map(n=>A(n,e))}function Pt(t){p("Can not find data set: "+y(t))}function Ge(t,e,n){if(!t){(e.domainMin!=null||e.domainMax!=null)&&p("No scale domain defined for domainMin/domainMax to override.");return}return t.signal?n.signalRef(t.signal):(C(t)?Ri:t.fields?Ei:vi)(t,e,n)}function Ri(t,e,n){return t.map(i=>A(i,n))}function vi(t,e,n){const i=n.getData(t.data);return i||Pt(t.data),Ot(e.type)?i.valuesRef(n,t.field,Ie(t.sort,!1)):De(e.type)?i.domainRef(n,t.field):i.extentRef(n,t.field)}function Ei(t,e,n){const i=t.data,a=t.fields.reduce((l,r)=>(r=q(r)?{data:i,field:r}:C(r)||r.signal?Oi(r,n):r,l.push(r),l),[]);return(Ot(e.type)?zi:De(e.type)?Di:Li)(t,n,a)}function Oi(t,e){const n="_:vega:_"+ki++,i=I({});if(C(t))i.value={$ingest:t};else if(t.signal){const a="setdata("+y(n)+","+t.signal+")";i.params.input=e.signalRef(a)}return e.addDataPipeline(n,[i,tt({})]),{data:n,field:"data"}}function zi(t,e,n){const i=Ie(t.sort,!0);let a,l;const r=n.map(u=>{const f=e.getData(u.data);return f||Pt(u.data),f.countsRef(e,u.field,i)}),o={groupby:Ut,pulse:r};i&&(a=i.op||"count",l=i.field?wt(a,i.field):"count",o.ops=[Ue[a]],o.fields=[e.fieldRef(l)],o.as=[l]),a=e.add(Te(o));const s=e.add(I({pulse:g(a)}));return l=e.add(xi({field:Ut,sort:e.sortRef(i),pulse:g(s)})),g(l)}function Ie(t,e){return t&&(!t.field&&!t.op?R(t)?t.field="key":t={field:"key"}:!t.field&&t.op!=="count"?p("No field provided for sort aggregate op: "+t.op):e&&t.field&&t.op&&!Ue[t.op]&&p("Multiple domain scales can not be sorted using "+t.op)),t}function Di(t,e,n){const i=n.map(a=>{const l=e.getData(a.data);return l||Pt(a.data),l.domainRef(e,a.field)});return g(e.add(di({values:i})))}function Li(t,e,n){const i=n.map(a=>{const l=e.getData(a.data);return l||Pt(a.data),l.extentRef(e,a.field)});return g(e.add(fi({extents:i})))}function wi(t,e){return t.signal||C(t)?Rt(t,e):e.objectProperty(t)}function Pi(t){return R(t)?{interval:A(t.interval),step:A(t.step)}:A(t)}function Ci(t,e){e.interpolate=A(t.type||t),t.gamma!=null&&(e.interpolateGamma=A(t.gamma))}function He(t,e,n){const i=e.config.range;let a=t.range;if(a.signal)return e.signalRef(a.signal);if(q(a)){if(i&&T(i,a))return t=v({},t,{range:i[a]}),He(t,e,n);a==="width"?a=[0,{signal:"width"}]:a==="height"?a=Ot(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:p("Unrecognized scale range value: "+y(a))}else if(a.scheme){n.scheme=C(a.scheme)?Rt(a.scheme,e):A(a.scheme,e),a.extent&&(n.schemeExtent=Rt(a.extent,e)),a.count&&(n.schemeCount=A(a.count,e));return}else if(a.step){n.rangeStep=A(a.step,e);return}else{if(Ot(t.type)&&!C(a))return Ge(a,t,e);C(a)||p("Unsupported range type: "+y(a))}return a.map(l=>(C(l)?Rt:A)(l,e))}function Fi(t,e){const n=e.config.projection||{},i={};for(const a in t)a!=="name"&&(i[a]=It(t[a],a,e));for(const a in n)i[a]==null&&(i[a]=It(n[a],a,e));e.addProjection(t.name,i)}function It(t,e,n){return C(t)?t.map(i=>It(i,e,n)):R(t)?t.signal?n.signalRef(t.signal):e==="fit"?t:p("Unsupported parameter object: "+y(t)):t}const H="top",st="left",ut="right",J="bottom",Xe="center",Wi="vertical",Ti="start",ji="middle",Ai="end",Ht="index",_t="label",Mi="offset",rt="perc",Bi="perc2",M="value",pt="guide-label",Zt="guide-title",Vi="group-title",Ui="group-subtitle",he="symbol",vt="gradient",Xt="discrete",qt="size",Gi="shape",Ii="fill",Hi="stroke",Xi="strokeWidth",qi="strokeDash",Yi="opacity",te=[qt,Gi,Ii,Hi,Xi,qi,Yi],bt={name:1,style:1,interactive:1},b={value:0},B={value:1},Ct="group",qe="rect",ee="rule",Ni="symbol",et="text";function yt(t){return t.type=Ct,t.interactive=t.interactive||!1,t}function F(t,e){const n=(i,a)=>U(t[i],U(e[i],a));return n.isVertical=i=>Wi===U(t.direction,e.direction||(i?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>U(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>U(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>U(t.columns,U(e.columns,+n.isVertical(!0))),n}function Ye(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function Ki(t,e,n){const i=e.config.style[n];return i&&i[t]}function Ft(t,e,n){return`item.anchor === '${Ti}' ? ${t} : item.anchor === '${Ai}' ? ${e} : ${n}`}const ne=Ft(y(st),y(ut),y(Xe));function Ji(t){const e=t("tickBand");let n=t("tickOffset"),i,a;return e?e.signal?(i={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},a={signal:`(${e.signal}) === 'extent'`},R(n)||(n={signal:`(${e.signal}) === 'extent' ? 0 : ${n}`})):e==="extent"?(i=1,a=!0,n=0):(i=.5,a=!1):(i=t("bandPosition"),a=t("tickExtra")),{extra:a,band:i,offset:n}}function Ne(t,e){return e?t?R(t)?Object.assign({},t,{offset:Ne(t.offset,e)}):{value:t,offset:e}:e:t}function j(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=ot(t.encode,e,bt)):t.interactive=!1,t}function Qi(t,e,n,i){const a=F(t,n),l=a.isVertical(),r=a.gradientThickness(),o=a.gradientLength();let s,u,f,d,c;l?(u=[0,1],f=[0,0],d=r,c=o):(u=[0,0],f=[1,0],d=o,c=r);const m={enter:s={opacity:b,x:b,y:b,width:z(d),height:z(c)},update:v({},s,{opacity:B,fill:{gradient:e,start:u,stop:f}}),exit:{opacity:b}};return L(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),j({type:qe,role:vn,encode:m},i)}function _i(t,e,n,i,a){const l=F(t,n),r=l.isVertical(),o=l.gradientThickness(),s=l.gradientLength();let u,f,d,c,m="";r?(u="y",d="y2",f="x",c="width",m="1-"):(u="x",d="x2",f="y",c="height");const h={opacity:b,fill:{scale:e,field:M}};h[u]={signal:m+"datum."+rt,mult:s},h[f]=b,h[d]={signal:m+"datum."+Bi,mult:s},h[c]=z(o);const k={enter:h,update:v({},h,{opacity:B}),exit:{opacity:b}};return L(k,{stroke:l("gradientStrokeColor"),strokeWidth:l("gradientStrokeWidth")},{opacity:l("gradientOpacity")}),j({type:qe,role:$n,key:M,from:a,encode:k},i)}const Zi=`datum.${rt}<=0?"${st}":datum.${rt}>=1?"${ut}":"${Xe}"`,ta=`datum.${rt}<=0?"${J}":datum.${rt}>=1?"${H}":"${ji}"`;function me(t,e,n,i){const a=F(t,e),l=a.isVertical(),r=z(a.gradientThickness()),o=a.gradientLength();let s=a("labelOverlap"),u,f,d,c,m="";const h={enter:u={opacity:b},update:f={opacity:B,text:{field:_t}},exit:{opacity:b}};return L(h,{fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:U(t.labelLimit,e.gradientLabelLimit)}),l?(u.align={value:"left"},u.baseline=f.baseline={signal:ta},d="y",c="x",m="1-"):(u.align=f.align={signal:Zi},u.baseline={value:"top"},d="x",c="y"),u[d]=f[d]={signal:m+"datum."+rt,mult:o},u[c]=f[c]=r,r.offset=U(t.labelOffset,e.gradientLabelOffset)||0,s=s?{separation:a("labelSeparation"),method:s,order:"datum."+Ht}:void 0,j({type:et,role:Le,style:pt,key:M,from:i,encode:h,overlap:s},n)}function ea(t,e,n,i,a){const l=F(t,e),r=n.entries,o=!!(r&&r.interactive),s=r?r.name:void 0,u=l("clipHeight"),f=l("symbolOffset"),d={data:"value"},c=`(${a}) ? datum.${Mi} : datum.${qt}`,m=u?z(u):{field:qt},h=`datum.${Ht}`,k=`max(1, ${a})`;let S,E,$,P,N;m.mult=.5,S={enter:E={opacity:b,x:{signal:c,mult:.5,offset:f},y:m},update:$={opacity:B,x:E.x,y:E.y},exit:{opacity:b}};let X=null,W=null;t.fill||(X=e.symbolBaseFillColor,W=e.symbolBaseStrokeColor),L(S,{fill:l("symbolFillColor",X),shape:l("symbolType"),size:l("symbolSize"),stroke:l("symbolStrokeColor",W),strokeDash:l("symbolDash"),strokeDashOffset:l("symbolDashOffset"),strokeWidth:l("symbolStrokeWidth")},{opacity:l("symbolOpacity")}),te.forEach(xt=>{t[xt]&&($[xt]=E[xt]={scale:t[xt],field:M})});const K=j({type:Ni,role:En,key:M,from:d,clip:u?!0:void 0,encode:S},n.symbols),V=z(f);V.offset=l("labelOffset"),S={enter:E={opacity:b,x:{signal:c,offset:V},y:m},update:$={opacity:B,text:{field:_t},x:E.x,y:E.y},exit:{opacity:b}},L(S,{align:l("labelAlign"),baseline:l("labelBaseline"),fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:l("labelLimit")});const ln=j({type:et,role:Le,style:pt,key:M,from:d,encode:S},n.labels);return S={enter:{noBound:{value:!u},width:b,height:u?z(u):b,opacity:b},exit:{opacity:b},update:$={opacity:B,row:{signal:null},column:{signal:null}}},l.isVertical(!0)?(P=`ceil(item.mark.items.length / ${k})`,$.row.signal=`${h}%${P}`,$.column.signal=`floor(${h} / ${P})`,N={field:["row",h]}):($.row.signal=`floor(${h} / ${k})`,$.column.signal=`${h} % ${k}`,N={field:h}),$.column.signal=`(${a})?${$.column.signal}:${h}`,i={facet:{data:i,name:"value",groupby:Ht}},yt({role:Kt,from:i,encode:ot(S,r,bt),marks:[K,ln],name:s,interactive:o,sort:N})}function na(t,e){const n=F(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const ie='item.orient === "left"',ae='item.orient === "right"',Wt=`(${ie} || ${ae})`,ia=`datum.vgrad && ${Wt}`,aa=Ft('"top"','"bottom"','"middle"'),la=Ft('"right"','"left"','"center"'),ra=`datum.vgrad && ${ae} ? (${la}) : (${Wt} && !(datum.vgrad && ${ie})) ? "left" : ${ne}`,oa=`item._anchor || (${Wt} ? "middle" : "start")`,sa=`${ia} ? (${ie} ? -90 : 90) : 0`,ua=`${Wt} ? (datum.vgrad ? (${ae} ? "bottom" : "top") : ${aa}) : "top"`;function fa(t,e,n,i){const a=F(t,e),l={enter:{opacity:b},update:{opacity:B,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:b}};return L(l,{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:oa},angle:{signal:sa},align:{signal:ra},baseline:{signal:ua},text:t.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),j({type:et,role:On,style:Zt,from:i,encode:l},n)}function da(t,e){let n;return R(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+ye(t.path)+")":t.sphere&&(n="geoShape("+ye(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function ye(t){return R(t)&&t.signal?t.signal:y(t)}function Ke(t){const e=t.role||"";return!e.indexOf("axis")||!e.indexOf("legend")||!e.indexOf("title")?e:t.type===Ct?Kt:e||Yt}function ga(t){return{marktype:t.type,name:t.name||void 0,role:t.role||Ke(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function ca(t,e){return t&&t.signal?e.signalRef(t.signal):t!==!1}function le(t,e){const n=dn(t.type);n||p("Unrecognized transform type: "+y(t.type));const i=Lt(n.type.toLowerCase(),null,Je(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=n.metadata||{},i}function Je(t,e,n){const i={},a=t.params.length;for(let l=0;l<a;++l){const r=t.params[l];i[r.name]=ha(r,e,n)}return i}function ha(t,e,n){const i=t.type,a=e[t.name];if(i==="index")return ma(t,e,n);if(a===void 0){t.required&&p("Missing required "+y(e.type)+" parameter: "+y(t.name));return}else{if(i==="param")return ya(t,e,n);if(i==="projection")return n.projectionRef(e[t.name])}return t.array&&!O(a)?a.map(l=>pe(t,l,n)):pe(t,a,n)}function pe(t,e,n){const i=t.type;if(O(e))return xe(i)?p("Expression references can not be signals."):Mt(i)?n.fieldRef(e):ke(i)?n.compareRef(e):n.signalRef(e.signal);{const a=t.expr||Mt(i);return a&&pa(e)?n.exprRef(e.expr,e.as):a&&ba(e)?ht(e.field,e.as):xe(i)?Y(e,n):xa(i)?g(n.getData(e).values):Mt(i)?ht(e):ke(i)?n.compareRef(e):e}}function ma(t,e,n){return q(e.from)||p('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}function ya(t,e,n){const i=e[t.name];return t.array?(C(i)||p("Expected an array of sub-parameters. Instead: "+y(i)),i.map(a=>be(t,a,n))):be(t,i,n)}function be(t,e,n){const i=t.params.length;let a;for(let r=0;r<i;++r){a=t.params[r];for(const o in a.key)if(a.key[o]!==e[o]){a=null;break}if(a)break}a||p("Unsupported parameter: "+y(e));const l=v(Je(a,e,n),a.key);return g(n.add(ci(l)))}const pa=t=>t&&t.expr,ba=t=>t&&t.field,xa=t=>t==="data",xe=t=>t==="expr",Mt=t=>t==="field",ke=t=>t==="compare";function ka(t,e,n){let i,a,l,r,o;return t?(i=t.facet)&&(e||p("Only group marks can be faceted."),i.field!=null?r=o=Et(i,n):(t.data?o=g(n.getData(t.data).aggregate):(l=le(v({type:"aggregate",groupby:w(i.groupby)},i.aggregate),n),l.params.key=n.keyRef(i.groupby),l.params.pulse=Et(i,n),r=o=g(n.add(l))),a=n.keyRef(i.groupby,!0))):r=g(n.add(I(null,[{}]))),r||(r=Et(t,n)),{key:a,pulse:r,parent:o}}function Et(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:g(e.getData(t.data).output)}function Z(t,e,n,i,a){this.scope=t,this.input=e,this.output=n,this.values=i,this.aggregate=a,this.index={}}Z.fromEntries=function(t,e){const n=e.length,i=e[n-1],a=e[n-2];let l=e[0],r=null,o=1;for(l&&l.type==="load"&&(l=e[1]),t.add(e[0]);o<n;++o)e[o].params.pulse=g(e[o-1]),t.add(e[o]),e[o].type==="aggregate"&&(r=e[o]);return new Z(t,l,a,i,r)};function Qe(t){return q(t)?t:null}function Se(t,e,n){const i=wt(n.op,n.field);let a;if(e.ops){for(let l=0,r=e.as.length;l<r;++l)if(e.as[l]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((a=n.op.signal)?t.signalRef(a):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function dt(t,e,n,i,a,l,r){const o=e[n]||(e[n]={}),s=In(l);let u=Qe(a),f,d;if(u!=null&&(t=e.scope,u=u+(s?"|"+s:""),f=o[u]),!f){const c=l?{field:Ut,pulse:e.countsRef(t,a,l)}:{field:t.fieldRef(a),pulse:g(e.output)};s&&(c.sort=t.sortRef(l)),d=t.add(Lt(i,void 0,c)),r&&(e.index[a]=d),f=g(d),u!=null&&(o[u]=f)}return f}Z.prototype={countsRef(t,e,n){const i=this,a=i.counts||(i.counts={}),l=Qe(e);let r,o,s;return l!=null&&(t=i.scope,r=a[l]),r?n&&n.field&&Se(t,r.agg.params,n):(s={groupby:t.fieldRef(e,"key"),pulse:g(i.output)},n&&n.field&&Se(t,s,n),o=t.add(Te(s)),r=t.add(I({pulse:g(o)})),r={agg:o,ref:g(r)},l!=null&&(a[l]=r)),r.ref},tuplesRef(){return g(this.values)},extentRef(t,e){return dt(t,this,"extent","extent",e,!1)},domainRef(t,e){return dt(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return dt(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return dt(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return dt(t,this,"indata","tupleindex",e,!0,!0)}};function Sa(t,e,n){const i=t.from.facet,a=i.name,l=Et(i,e);let r;i.name||p("Facet must have a name: "+y(i)),i.data||p("Facet must reference a data set: "+y(i)),i.field?r=e.add(Me({field:e.fieldRef(i.field),pulse:l})):i.groupby?r=e.add(ai({key:e.keyRef(i.groupby),group:g(e.proxy(n.parent)),pulse:l})):p("Facet must specify groupby or field: "+y(i));const o=e.fork(),s=o.add(I()),u=o.add(tt({pulse:g(s)}));o.addData(a,new Z(o,s,s,u)),o.addSignal("parent",null),r.params.subflow={$subflow:o.parse(t).toRuntime()}}function $a(t,e,n){const i=e.add(Me({pulse:n.pulse})),a=e.fork();a.add(tt()),a.addSignal("parent",null),i.params.subflow={$subflow:a.parse(t).toRuntime()}}function _e(t,e,n){const i=t.remove,a=t.insert,l=t.toggle,r=t.modify,o=t.values,s=e.add(zt()),u="if("+t.trigger+',modify("'+n+'",'+[a,i,l,r,o].map(d=>d??"null").join(",")+"),0)",f=Y(u,e);s.update=f.$expr,s.params=f.$params}function Tt(t,e){const n=Ke(t),i=t.type===Ct,a=t.from&&t.from.facet,l=t.overlap;let r=t.layout||n===Kt||n===Nt,o,s,u,f,d,c,m;const h=n===Yt||r||a,k=ka(t.from,i,e);s=e.add(ni({key:k.key||(t.key?ht(t.key):void 0),pulse:k.pulse,clean:!i}));const S=g(s);s=u=e.add(I({pulse:S})),s=e.add(ui({markdef:ga(t),interactive:ca(t.interactive,e),clip:da(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:g(s)}));const E=g(s);s=f=e.add(Ae(Fe(t.encode,t.type,n,t.style,e,{mod:!1,pulse:E}))),s.params.parent=e.encode(),t.transform&&t.transform.forEach(W=>{const K=le(W,e),V=K.metadata;(V.generates||V.changes)&&p("Mark transforms should not generate new data."),V.nomod||(f.params.mod=!0),K.params.pulse=g(s),e.add(s=K)}),t.sort&&(s=e.add(bi({sort:e.compareRef(t.sort),pulse:g(s)})));const $=g(s);(a||r)&&(r=e.add(Ve({layout:e.objectProperty(t.layout),legends:e.legends,mark:E,pulse:$})),c=g(r));const P=e.add(je({mark:E,pulse:c||$}));m=g(P),i&&(h&&(o=e.operators,o.pop(),r&&o.pop()),e.pushState($,c||m,S),a?Sa(t,e,k):h?$a(t,e,k):e.parse(t),e.popState(),h&&(r&&o.push(r),o.push(P))),l&&(m=Ra(l,m,e));const N=e.add(Be({pulse:m})),X=e.add(tt({pulse:g(N)},void 0,e.parent()));t.name!=null&&(d=t.name,e.addData(d,new Z(e,u,N,X)),t.on&&t.on.forEach(W=>{(W.insert||W.remove||W.toggle)&&p("Marks only support modify triggers."),_e(W,e,d)}))}function Ra(t,e,n){const i=t.method,a=t.bound,l=t.separation,r={separation:O(l)?n.signalRef(l.signal):l,method:O(i)?n.signalRef(i.signal):i,pulse:e};if(t.order&&(r.sort=n.compareRef({field:t.order})),a){const o=a.tolerance;r.boundTolerance=O(o)?n.signalRef(o.signal):+o,r.boundScale=n.scaleRef(a.scale),r.boundOrient=a.orient}return g(n.add(gi(r)))}function va(t,e){const n=e.config.legend,i=t.encode||{},a=F(t,n),l=i.legend||{},r=l.name||void 0,o=l.interactive,s=l.style,u={};let f=0,d,c,m;te.forEach(P=>t[P]?(u[P]=t[P],f=f||t[P]):0),f||p("Missing valid scale for legend.");const h=Ea(t,e.scaleType(f)),k={title:t.title!=null,scales:u,type:h,vgrad:h!=="symbol"&&a.isVertical()},S=g(e.add(I(null,[k]))),E={enter:{x:{value:0},y:{value:0}}},$=g(e.add(oi(c={type:h,scale:e.scaleRef(f),count:e.objectProperty(a("tickCount")),limit:e.property(a("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return h===vt?(m=[Qi(t,f,n,i.gradient),me(t,n,i.labels,$)],c.count=c.count||e.signalRef(`max(2,2*floor((${_(a.gradientLength())})/100))`)):h===Xt?m=[_i(t,f,n,i.gradient,$),me(t,n,i.labels,$)]:(d=na(t,n),m=[ea(t,n,i,$,_(d.columns))],c.size=Da(t,e,m[0].marks)),m=[yt({role:Rn,from:S,encode:E,marks:m,layout:d,interactive:o})],k.title&&m.push(fa(t,n,i.title,S)),Tt(yt({role:Sn,from:S,encode:ot(za(a,t,n),l,bt),marks:m,aria:a("aria"),description:a("description"),zindex:a("zindex"),name:r,interactive:o,style:s}),e)}function Ea(t,e){let n=t.type||he;return!t.type&&Oa(t)===1&&(t.fill||t.stroke)&&(n=fn(e)?vt:se(e)?Xt:he),n!==vt?n:se(e)?Xt:vt}function Oa(t){return te.reduce((e,n)=>e+(t[n]?1:0),0)}function za(t,e,n){const i={enter:{},update:{}};return L(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}function Da(t,e,n){const i=_($e("size",t,n)),a=_($e("strokeWidth",t,n)),l=_(La(n[1].encode,e,pt));return Y(`max(ceil(sqrt(${i})+${a}),${l})`,e)}function $e(t,e,n){return e[t]?`scale("${e[t]}",datum)`:Ye(t,n[0].encode)}function La(t,e,n){return Ye("fontSize",t)||Ki("fontSize",e,n)}const wa=`item.orient==="${st}"?-90:item.orient==="${ut}"?90:0`;function Pa(t,e){t=q(t)?{text:t}:t;const n=F(t,e.config.title),i=t.encode||{},a=i.group||{},l=a.name||void 0,r=a.interactive,o=a.style,s=[],u={},f=g(e.add(I(null,[u])));return s.push(Wa(t,n,Ca(t),f)),t.subtitle&&s.push(Ta(t,n,i.subtitle,f)),Tt(yt({role:zn,from:f,encode:Fa(n,a),marks:s,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:l,interactive:r,style:o}),e)}function Ca(t){const e=t.encode;return e&&e.title||v({name:t.name,interactive:t.interactive,style:t.style},e)}function Fa(t,e){const n={enter:{},update:{}};return L(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:ne},angle:{signal:wa},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),ot(n,e,bt)}function Wa(t,e,n,i){const a={value:0},l=t.text,r={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return L(r,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),j({type:et,role:Dn,style:Vi,from:i,encode:r},n)}function Ta(t,e,n,i){const a={value:0},l=t.subtitle,r={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return L(r,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),j({type:et,role:Ln,style:Ui,from:i,encode:r},n)}function ja(t,e){const n=[];t.transform&&t.transform.forEach(i=>{n.push(le(i,e))}),t.on&&t.on.forEach(i=>{_e(i,e,t.name)}),e.addDataPipeline(t.name,Aa(t,e,n))}function Aa(t,e,n){const i=[];let a=null,l=!1,r=!1,o,s,u,f,d;for(t.values?O(t.values)||$t(t.format)?(i.push(Re(e,t)),i.push(a=Q())):i.push(a=Q({$ingest:t.values,$format:t.format})):t.url?$t(t.url)||$t(t.format)?(i.push(Re(e,t)),i.push(a=Q())):i.push(a=Q({$request:t.url,$format:t.format})):t.source&&(a=o=w(t.source).map(c=>g(e.getData(c).output)),i.push(null)),s=0,u=n.length;s<u;++s)f=n[s],d=f.metadata,!a&&!d.source&&i.push(a=Q()),i.push(f),d.generates&&(r=!0),d.modifies&&!r&&(l=!0),d.source?a=f:d.changes&&(a=null);return o&&(u=o.length-1,i[0]=yi({derive:l,pulse:u?o:o[0]}),(l||u)&&i.splice(1,0,Q())),a||i.push(Q()),i.push(tt({})),i}function Q(t){const e=I({},t);return e.metadata={source:!0},e}function Re(t,e){return si({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const Ze=t=>t===J||t===H,jt=(t,e,n)=>O(t)?Ua(t.signal,e,n):t===st||t===H?e:n,D=(t,e,n)=>O(t)?Ba(t.signal,e,n):Ze(t)?e:n,G=(t,e,n)=>O(t)?Va(t.signal,e,n):Ze(t)?n:e,tn=(t,e,n)=>O(t)?Ga(t.signal,e,n):t===H?{value:e}:{value:n},Ma=(t,e,n)=>O(t)?Ia(t.signal,e,n):t===ut?{value:e}:{value:n},Ba=(t,e,n)=>en(`${t} === '${H}' || ${t} === '${J}'`,e,n),Va=(t,e,n)=>en(`${t} !== '${H}' && ${t} !== '${J}'`,e,n),Ua=(t,e,n)=>re(`${t} === '${st}' || ${t} === '${H}'`,e,n),Ga=(t,e,n)=>re(`${t} === '${H}'`,e,n),Ia=(t,e,n)=>re(`${t} === '${ut}'`,e,n),en=(t,e,n)=>(e=e!=null?z(e):e,n=n!=null?z(n):n,ve(e)&&ve(n)?(e=e?e.signal||y(e.value):null,n=n?n.signal||y(n.value):null,{signal:`${t} ? (${e}) : (${n})`}):[v({test:t},e)].concat(n||[])),ve=t=>t==null||Object.keys(t).length===1,re=(t,e,n)=>({signal:`${t} ? (${at(e)}) : (${at(n)})`}),Ha=(t,e,n,i,a)=>({signal:(i!=null?`${t} === '${st}' ? (${at(i)}) : `:"")+(n!=null?`${t} === '${J}' ? (${at(n)}) : `:"")+(a!=null?`${t} === '${ut}' ? (${at(a)}) : `:"")+(e!=null?`${t} === '${H}' ? (${at(e)}) : `:"")+"(null)"}),at=t=>O(t)?t.signal:t==null?null:y(t),Xa=(t,e)=>e===0?0:O(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e},lt=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function nt(t,e,n,i){let a;if(e&&T(e,t))return e[t];if(T(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":a="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":a=t[5].toLowerCase()+t.slice(6)}return i[Zt][a]}else if(t.startsWith("label")){switch(t){case"labelColor":a="fill";break;case"labelFont":case"labelFontSize":a=t[5].toLowerCase()+t.slice(6)}return i[pt][a]}return null}function Ee(t){const e={};for(const n of t)if(n)for(const i in n)e[i]=1;return Object.keys(e)}function qa(t,e){var n=e.config,i=n.style,a=n.axis,l=e.scaleType(t.scale)==="band"&&n.axisBand,r=t.orient,o,s,u;if(O(r)){const d=Ee([n.axisX,n.axisY]),c=Ee([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);o={};for(u of d)o[u]=D(r,nt(u,n.axisX,a,i),nt(u,n.axisY,a,i));s={};for(u of c)s[u]=Ha(r.signal,nt(u,n.axisTop,a,i),nt(u,n.axisBottom,a,i),nt(u,n.axisLeft,a,i),nt(u,n.axisRight,a,i))}else o=r===H||r===J?n.axisX:n.axisY,s=n["axis"+r[0].toUpperCase()+r.slice(1)];return o||s||l?v({},a,o,s,l):a}function Ya(t,e,n,i){const a=F(t,e),l=t.orient;let r,o;const s={enter:r={opacity:b},update:o={opacity:B},exit:{opacity:b}};L(s,{stroke:a("domainColor"),strokeCap:a("domainCap"),strokeDash:a("domainDash"),strokeDashOffset:a("domainDashOffset"),strokeWidth:a("domainWidth"),strokeOpacity:a("domainOpacity")});const u=Oe(t,0),f=Oe(t,1);return r.x=o.x=D(l,u,b),r.x2=o.x2=D(l,f),r.y=o.y=G(l,u,b),r.y2=o.y2=G(l,f),j({type:ee,role:yn,from:i,encode:s},n)}function Oe(t,e){return{scale:t.scale,range:e}}function Na(t,e,n,i,a){const l=F(t,e),r=t.orient,o=t.gridScale,s=jt(r,1,-1),u=Ka(t.offset,s);let f,d,c;const m={enter:f={opacity:b},update:c={opacity:B},exit:d={opacity:b}};L(m,{stroke:l("gridColor"),strokeCap:l("gridCap"),strokeDash:l("gridDash"),strokeDashOffset:l("gridDashOffset"),strokeOpacity:l("gridOpacity"),strokeWidth:l("gridWidth")});const h={scale:t.scale,field:M,band:a.band,extra:a.extra,offset:a.offset,round:l("tickRound")},k=D(r,{signal:"height"},{signal:"width"}),S=o?{scale:o,range:0,mult:s,offset:u}:{value:0,offset:u},E=o?{scale:o,range:1,mult:s,offset:u}:v(k,{mult:s,offset:u});return f.x=c.x=D(r,h,S),f.y=c.y=G(r,h,S),f.x2=c.x2=G(r,E),f.y2=c.y2=D(r,E),d.x=D(r,h),d.y=G(r,h),j({type:ee,role:pn,key:M,from:i,encode:m},n)}function Ka(t,e){if(e!==1)if(!R(t))t=O(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);else{let n=t=v({},t);for(;n.mult!=null;)if(R(n.mult))n=n.mult=v({},n.mult);else return n.mult=O(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n.mult=e}return t}function Ja(t,e,n,i,a,l){const r=F(t,e),o=t.orient,s=jt(o,-1,1);let u,f,d;const c={enter:u={opacity:b},update:d={opacity:B},exit:f={opacity:b}};L(c,{stroke:r("tickColor"),strokeCap:r("tickCap"),strokeDash:r("tickDash"),strokeDashOffset:r("tickDashOffset"),strokeOpacity:r("tickOpacity"),strokeWidth:r("tickWidth")});const m=z(a);m.mult=s;const h={scale:t.scale,field:M,band:l.band,extra:l.extra,offset:l.offset,round:r("tickRound")};return d.y=u.y=D(o,b,h),d.y2=u.y2=D(o,m),f.x=D(o,h),d.x=u.x=G(o,b,h),d.x2=u.x2=G(o,m),f.y=G(o,h),j({type:ee,role:xn,key:M,from:i,encode:c},n)}function Bt(t,e,n,i,a){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+i+","+a+")"}}function Qa(t,e,n,i,a,l){const r=F(t,e),o=t.orient,s=t.scale,u=jt(o,-1,1),f=_(r("labelFlush")),d=_(r("labelFlushOffset")),c=r("labelAlign"),m=r("labelBaseline");let h=f===0||!!f,k;const S=z(a);S.mult=u,S.offset=z(r("labelPadding")||0),S.offset.mult=u;const E={scale:s,field:M,band:.5,offset:Ne(l.offset,r("labelOffset"))},$=D(o,h?Bt(s,f,'"left"','"right"','"center"'):{value:"center"},Ma(o,"left","right")),P=D(o,tn(o,"bottom","top"),h?Bt(s,f,'"top"','"bottom"','"middle"'):{value:"middle"}),N=Bt(s,f,`-(${d})`,d,0);h=h&&d;const X={opacity:b,x:D(o,E,S),y:G(o,E,S)},W={enter:X,update:k={opacity:B,text:{field:_t},x:X.x,y:X.y,align:$,baseline:P},exit:{opacity:b,x:X.x,y:X.y}};L(W,{dx:!c&&h?D(o,N):null,dy:!m&&h?G(o,N):null}),L(W,{angle:r("labelAngle"),fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontWeight:r("labelFontWeight"),fontStyle:r("labelFontStyle"),limit:r("labelLimit"),lineHeight:r("labelLineHeight")},{align:c,baseline:m});const K=r("labelBound");let V=r("labelOverlap");return V=V||K?{separation:r("labelSeparation"),method:V,order:"datum.index",bound:K?{scale:s,orient:o,tolerance:K}:null}:void 0,k.align!==$&&(k.align=lt(k.align,$)),k.baseline!==P&&(k.baseline=lt(k.baseline,P)),j({type:et,role:bn,style:pt,key:M,from:i,encode:W,overlap:V},n)}function _a(t,e,n,i){const a=F(t,e),l=t.orient,r=jt(l,-1,1);let o,s;const u={enter:o={opacity:b,anchor:z(a("titleAnchor",null)),align:{signal:ne}},update:s=v({},o,{opacity:B,text:z(t.title)}),exit:{opacity:b}},f={signal:`lerp(range("${t.scale}"), ${Ft(0,1,.5)})`};return s.x=D(l,f),s.y=G(l,f),o.angle=D(l,b,Xa(r,90)),o.baseline=D(l,tn(l,J,H),{value:J}),s.angle=o.angle,s.baseline=o.baseline,L(u,{fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),angle:a("titleAngle"),baseline:a("titleBaseline")}),Za(a,l,u,n),u.update.align=lt(u.update.align,o.align),u.update.angle=lt(u.update.angle,o.angle),u.update.baseline=lt(u.update.baseline,o.baseline),j({type:et,role:kn,style:Zt,from:i,encode:u},n)}function Za(t,e,n,i){const a=(o,s)=>o!=null?(n.update[s]=lt(z(o),n.update[s]),!1):!it(s,i),l=a(t("titleX"),"x"),r=a(t("titleY"),"y");n.enter.auto=r===l?z(r):D(e,z(r),z(l))}function tl(t,e){const n=qa(t,e),i=t.encode||{},a=i.axis||{},l=a.name||void 0,r=a.interactive,o=a.style,s=F(t,n),u=Ji(s),f={scale:t.scale,ticks:!!s("ticks"),labels:!!s("labels"),grid:!!s("grid"),domain:!!s("domain"),title:t.title!=null},d=g(e.add(I({},[f]))),c=g(e.add(ei({scale:e.scaleRef(t.scale),extra:e.property(u.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),m=[];let h;return f.grid&&m.push(Na(t,n,i.grid,c,u)),f.ticks&&(h=s("tickSize"),m.push(Ja(t,n,i.ticks,c,h,u))),f.labels&&(h=f.ticks?h:0,m.push(Qa(t,n,i.labels,c,h,u))),f.domain&&m.push(Ya(t,n,i.domain,d)),f.title&&m.push(_a(t,n,i.title,d)),Tt(yt({role:mn,from:d,encode:ot(el(s,t),a,bt),marks:m,aria:s("aria"),description:s("description"),zindex:s("zindex"),name:l,interactive:r,style:o}),e)}function el(t,e){const n={enter:{},update:{}};return L(n,{orient:t("orient"),offset:t("offset")||0,position:U(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function nn(t,e,n){const i=w(t.signals),a=w(t.scales);return n||i.forEach(l=>We(l,e)),w(t.projections).forEach(l=>Fi(l,e)),a.forEach(l=>Si(l,e)),w(t.data).forEach(l=>ja(l,e)),a.forEach(l=>$i(l,e)),(n||i).forEach(l=>ti(l,e)),w(t.axes).forEach(l=>tl(l,e)),w(t.marks).forEach(l=>Tt(l,e)),w(t.legends).forEach(l=>va(l,e)),t.title&&Pa(t.title,e),e.parseLambdas(),e}const nl=t=>ot({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function il(t,e){const n=e.config,i=g(e.root=e.add(zt())),a=al(t,n);a.forEach(u=>We(u,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const l=e.add(I()),r=e.add(Ae(Fe(nl(t.encode),Ct,Nt,t.style,e,{pulse:g(l)}))),o=e.add(Ve({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:g(r)}));e.operators.pop(),e.pushState(g(r),g(o),null),nn(t,e,a),e.operators.push(o);let s=e.add(je({mark:i,pulse:g(o)}));return s=e.add(Be({pulse:g(s)})),s=e.add(tt({pulse:g(s)})),e.addData("root",new Z(e,l,l,s)),e}function gt(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function al(t,e){const n=r=>U(t[r],e[r]),i=[gt("background",n("background")),gt("autosize",gn(n("autosize"))),gt("padding",hn(n("padding"))),gt("width",n("width")||0),gt("height",n("height")||0)],a=i.reduce((r,o)=>(r[o.name]=o,r),{}),l={};return w(t.signals).forEach(r=>{T(a,r.name)?r=v(a[r.name],r):i.push(r),l[r.name]=r}),w(e.signals).forEach(r=>{!T(l,r.name)&&!T(a,r.name)&&i.push(r)}),i}function an(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function ze(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}an.prototype=ze.prototype={parse(t){return nn(t,this)},fork(){return new ze(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(e=>{e.$ref=t.id}),t.refs=null),t},proxy(t){const e=t instanceof Vt?g(t):t;return this.add(mi({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(i,a,l){let r,o;i&&(r=i.data||(i.data={}),o=r[a]||(r[a]=[]),o.push(l))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const i in e.index)n(e.index[i],t,"index:"+i)}return this},pushState(t,e,n){this._encode.push(g(this.add(tt({pulse:t})))),this._parent.push(e),this._lookup.push(n?g(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ct(this._parent)},encode(){return ct(this._encode)},lookup(){return ct(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(q(t))return ht(t,e);t.signal||p("Unsupported field reference: "+y(t));const n=t.signal;let i=this.field[n];if(!i){const a={name:this.signalRef(n)};e&&(a.as=e),this.field[n]=i=g(this.add(li(a)))}return i},compareRef(t){let e=!1;const n=l=>O(l)?(e=!0,this.signalRef(l.signal)):Hn(l)?(e=!0,this.exprRef(l.expr)):l,i=w(t.field).map(n),a=w(t.order).map(n);return e?g(this.add(ce({fields:i,orders:a}))):de(i,a)},keyRef(t,e){let n=!1;const i=l=>O(l)?(n=!0,g(a[l.signal])):l,a=this.signals;return t=w(t).map(i),n?g(this.add(ri({fields:t,flat:e}))):Vn(t,e)},sortRef(t){if(!t)return t;const e=wt(t.op,t.field),n=t.order||Un;return n.signal?g(this.add(ce({fields:e,orders:this.signalRef(n.signal)}))):de(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[n]=i}return this.events[n]},hasOwnSignal(t){return T(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&p("Duplicate signal name: "+y(t));const n=e instanceof Vt?e:this.add(zt(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||p("Unrecognized signal name: "+y(t)),this.signals[t]},signalRef(t){return this.signals[t]?g(this.signals[t]):(T(this.lambdas,t)||(this.lambdas[t]=this.add(zt(null))),g(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const i=t[e],a=Y(i,this),l=this.lambdas[i];l.params=a.$params,l.update=a.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return!t||!R(t)?t:this.signalRef(t.signal||oe(t))},exprRef(t,e){const n={expr:Y(t,this)};return e&&(n.expr.$name=e),g(this.add(ii(n)))},addBinding(t,e){this.bindings||p("Nested signals do not support binding: "+y(t)),this.bindings.push(v({signal:t},e))},addScaleProj(t,e){T(this.scales,t)&&p("Duplicate scale or projection name: "+y(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,pi(e))},addProjection(t,e){this.addScaleProj(t,hi(e))},getScale(t){return this.scales[t]||p("Unrecognized scale name: "+y(t)),this.scales[t]},scaleRef(t){return g(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return T(this.data,t)&&p("Duplicate data set name: "+y(t)),this.data[t]=e},getData(t){return this.data[t]||p("Undefined data set name: "+y(t)),this.data[t]},addDataPipeline(t,e){return T(this.data,t)&&p("Duplicate data set name: "+y(t)),this.addData(t,Z.fromEntries(this,e))}};function oe(t){return(C(t)?ll:rl)(t)}function ll(t){const e=t.length;let n="[";for(let i=0;i<e;++i){const a=t[i];n+=(i>0?",":"")+(R(a)?a.signal||oe(a):y(a))}return n+"]"}function rl(t){let e="{",n=0,i,a;for(i in t)a=t[i],e+=(++n>1?",":"")+y(i)+":"+(R(a)?a.signal||oe(a):y(a));return e+"}"}function ol(){const t="sans-serif",i="#4c78a8",a="#000",l="#888",r="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:a},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:a,font:t,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:a,font:t,fontSize:10},"guide-title":{fill:a,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:a,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:a,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:r},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:l,grid:!1,gridWidth:1,gridColor:r,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:l,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:r,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:l,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function cl(t,e,n){return R(t)||p("Input Vega specification must be an object."),e=rn(ol(),e,t.config),il(t,new an(e,n)).toRuntime()}export{cl as p};
