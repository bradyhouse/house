import{u as se,k as f,r as S,a6 as ae,C as v,w as p,e as E,$ as oe,G as A,d as ue,j as le,y as q,i as W,a3 as ce}from"./vega-util-7f144c9d.js";import{D as b,j as de,c as T,k as he,E as fe,t as $}from"./vega-dataflow-7e3fa937.js";import{P as D,C as F,R as h,g as ge,O as pe}from"./vega-scenegraph-d3a31be7.js";import{f as me}from"./vega-functions-181775c3.js";import{c as _e}from"./vega-runtime-9525a1d6.js";import{l as be}from"./vega-format-43826777.js";import{i as ze}from"./d3-timer-91fe3b35.js";import{t as ke}from"./d3-array-ee3dc224.js";function ve(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),J(t,e.description()))}function J(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Ce(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const L="default";function ye(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:L,item:null}));e.on(e.events("view","mousemove"),t,(n,r)=>{const i=t.value,s=i?A(i)?i:i.user:L,a=r.item&&r.item.cursor||null;return i&&s===i.user&&a==i.item?i:{user:s,item:a}}),e.add(null,function(n){let r=n.cursor,i=this.value;return A(r)||(i=r.item,r=r.user),R(e,r&&r!==L?r:i||r),i},{cursor:t})}function R(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function z(e,t){var n=e._runtime.data;return S(n,t)||f("Unrecognized data set: "+t),n[t]}function Le(e,t){return arguments.length<2?z(this,e).values.value:C.call(this,e,T().remove(ae).insert(t))}function C(e,t){he(t)||f("Second argument to changes must be a changeset.");const n=z(this,e);return n.modified=!0,this.pulse(n.input,t)}function xe(e,t){return C.call(this,e,T().insert(t))}function Ee(e,t){return C.call(this,e,T().remove(t))}function K(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function Q(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function y(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Ae(e){var t=y(e),n=K(e),r=Q(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach(i=>{try{i(n,r)}catch(s){e.error(s)}})}function Re(e,t,n){var r=e._renderer,i=r&&r.canvas(),s,a,o;return i&&(o=y(e),a=t.changedTouches?t.changedTouches[0]:t,s=pe(a,i),s[0]-=o[0],s[1]-=o[1]),t.dataflow=e,t.item=n,t.vega=Se(e,n,s),t}function Se(e,t,n){const r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(a){var o=r,u;if(a){for(u=t;u;u=u.mark.group)if(u.mark.name===a){o=u;break}}return o&&o.mark&&o.mark.interactive?o:{}}function s(a){if(!a)return n;A(a)&&(a=i(a));const o=n.slice();for(;a;)o[0]-=a.x||0,o[1]-=a.y||0,a=a.mark&&a.mark.group;return o}return{view:W(e),item:W(t||{}),group:i,xy:s,x:a=>s(a)[0],y:a=>s(a)[1]}}const V="view",Te="timer",De="window",Oe={trap:!1};function He(e){const t=E({defaults:{}},e),n=(r,i)=>{i.forEach(s=>{p(r[s])&&(r[s]=ce(r[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function X(e,t,n,r){e._eventListeners.push({type:n,sources:ue(t),handler:r})}function Ue(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[t]:i?!i[t]:e.preventDefault()}function m(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return r===!1||v(r)&&!r[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function We(e,t,n){var r=this,i=new fe(n),s=function(l,d){r.runAsync(null,()=>{e===V&&Ue(r,t)&&l.preventDefault(),i.receive(Re(r,l,d))})},a;if(e===Te)m(r,"timer",t)&&r.timer(s,t);else if(e===V)m(r,"view",t)&&r.addEventListener(t,s,Oe);else if(e===De?m(r,"window",t)&&typeof window<"u"&&(a=[window]):typeof document<"u"&&m(r,"selector",t)&&(a=Array.from(document.querySelectorAll(e))),!a)r.warn("Can not resolve event source: "+e);else{for(var o=0,u=a.length;o<u;++o)a[o].addEventListener(t,s);X(r,a,t,s)}return i}function G(e){return e.item}function j(e){return e.item.mark.source}function I(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Ve(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",G),j,I(e)),this.on(this.events("view","mouseout",G),j,I(t)),this}function Ge(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,s;for(r=t.length;--r>=0;)t[r].stop();for(r=n.length;--r>=0;)for(s=n[r],i=s.sources.length;--i>=0;)s.sources[i].removeEventListener(s.type,s.handler);return e&&e.call(this,this._handler,null,null,null),this}function c(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const je="vega-bind",Ie="vega-bind-name",Me="vega-bind-radio";function Pe(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:a=>{a!=e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,a)})}},r.debounce&&(i.update=le(r.debounce,i.update))),(r.input==null&&r.element?Be:qe)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0),i}function Be(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),X(r,t,i,s),e.set=a=>{t.value=a,t.dispatchEvent(Ne(i))}}function Ne(e){return typeof Event<"u"?new Event(e):{type:e}}function qe(e,t,n,r){const i=r.signal(n.signal),s=c("div",{class:je}),a=n.input==="radio"?s:s.appendChild(c("label"));a.appendChild(c("span",{class:Ie},n.name||n.signal)),t.appendChild(s);let o=$e;switch(n.input){case"checkbox":o=Fe;break;case"select":o=Je;break;case"radio":o=Ke;break;case"range":o=Qe;break}o(e,a,n,i)}function $e(e,t,n,r){const i=c("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function Fe(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=c("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=a=>s.checked=!!a||null}function Je(e,t,n,r){const i=c("select",{name:n.signal}),s=n.labels||[];n.options.forEach((a,o)=>{const u={value:a};k(a,r)&&(u.selected=!0),i.appendChild(c("option",u,(s[o]||a)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=a=>{for(let o=0,u=n.options.length;o<u;++o)if(k(n.options[o],a)){i.selectedIndex=o;return}}}function Ke(e,t,n,r){const i=c("span",{class:Me}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((a,o)=>{const u={type:"radio",name:n.signal,value:a};k(a,r)&&(u.checked=!0);const l=c("input",u);l.addEventListener("change",()=>e.update(a));const d=c("label",{},(s[o]||a)+"");return d.prepend(l),i.appendChild(d),l}),e.set=a=>{const o=e.elements,u=o.length;for(let l=0;l<u;++l)k(o[l].value,a)&&(o[l].checked=!0)}}function Qe(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,a=n.step||ke(s,i,100),o=c("input",{type:"range",name:n.signal,min:s,max:i,step:a});o.value=r;const u=c("span",{},+r);t.appendChild(o),t.appendChild(u);const l=()=>{u.textContent=o.value,e.update(+o.value)};o.addEventListener("input",l),o.addEventListener("change",l),e.elements=[o],e.set=d=>{o.value=d,u.textContent=d}}function k(e,t){return e===t||e+""==t+""}function Y(e,t,n,r,i,s){return t=t||new r(e.loader()),t.initialize(n,K(e),Q(e),y(e),i,s).background(e.background())}function O(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function Xe(e,t,n,r){const i=new r(e.loader(),O(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,y(e),e);return t&&t.handlers().forEach(s=>{i.on(s.type,s.handler)}),i}function Ye(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=D(r);e=n._el=e?x(n,e,!0):null,ve(n),s||n.error("Unrecognized renderer type: "+r);const a=s.handler||F,o=e?s.renderer:s.headless;return n._renderer=o?Y(n,n._renderer,e,o):null,n._handler=Xe(n,n._handler,e,a),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=x(n,t,!0):e.appendChild(c("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&i!=="container"&&(u.element=x(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{Pe(n,u.element||t,u)})),n}function x(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.textContent=""}catch(r){t=null,e.error(r)}return t}const g=e=>+e||0,Ze=e=>({top:e,bottom:e,left:e,right:e});function M(e){return v(e)?{top:g(e.top),bottom:g(e.bottom),left:g(e.left),right:g(e.right)}:Ze(g(e))}async function H(e,t,n,r){const i=D(t),s=i&&i.headless;return s||f("Unrecognized renderer type: "+t),await e.runAsync(),Y(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}async function we(e,t){e!==h.Canvas&&e!==h.SVG&&e!==h.PNG&&f("Unrecognized image type: "+e);const n=await H(this,e,t);return e===h.SVG?et(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function et(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function tt(e,t){return(await H(this,h.Canvas,e,t)).canvas()}async function nt(e){return(await H(this,h.SVG,e)).svg()}function rt(e,t,n){return _e(e,$,me,n).parse(t)}function it(e){var t=this._runtime.scales;return S(t,e)||f("Unrecognized scale or projection: "+e),t[e].value}var Z="width",w="height",U="padding",P={skip:!0};function ee(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===U?r.left+r.right:0)}function te(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===U?r.top+r.bottom:0)}function st(e){var t=e._signals,n=t[Z],r=t[w],i=t[U];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,o=>{e._width=o.size,e._viewWidth=ee(e,o.size),s()},{size:n}),e._resizeHeight=e.add(null,o=>{e._height=o.size,e._viewHeight=te(e,o.size),s()},{size:r});const a=e.add(null,s,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,a.rank=i.rank+1}function at(e,t,n,r,i,s){this.runAfter(a=>{let o=0;a._autosize=0,a.width()!==n&&(o=1,a.signal(Z,n,P),a._resizeWidth.skip(!0)),a.height()!==r&&(o=1,a.signal(w,r,P),a._resizeHeight.skip(!0)),a._viewWidth!==e&&(a._resize=1,a._viewWidth=e),a._viewHeight!==t&&(a._resize=1,a._viewHeight=t),(a._origin[0]!==i[0]||a._origin[1]!==i[1])&&(a._resize=1,a._origin=i),o&&a.run("enter"),s&&a.runAfter(u=>u.resize())},!1,1)}function ot(e){return this._runtime.getState(e||{data:ut,signals:lt,recurse:!0})}function ut(e,t){return t.modified&&p(t.input.value)&&e.indexOf("_:vega:_")}function lt(e,t){return!(e==="parent"||t instanceof $.proxy)}function ct(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function dt(e,t){function n(r){e({timestamp:Date.now(),elapsed:r})}this._timers.push(ze(n,t))}function ht(e,t,n,r){const i=e.element();i&&i.setAttribute("title",ft(r))}function ft(e){return e==null?"":p(e)?ne(e):v(e)&&!q(e)?gt(e):e+""}function gt(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(p(n)?ne(n):re(n))}).join(`
`)}function ne(e){return"["+e.map(re).join(", ")+"]"}function re(e){return p(e)?"[…]":v(e)&&!q(e)?"{…}":e}function pt(e,t){const n=this;if(t=t||{},b.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=E({},e.locale,t.locale);n.locale(be(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||h.Canvas,n._scenegraph=new ge;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||ht,n._redraw=!0,n._handler=new F().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=He(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=rt(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:E({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=ee(n,n._width),n._viewHeight=te(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,st(n),Ce(n),ye(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function _(e,t){return S(e._signals,t)?e._signals[t]:f("Unrecognized signal name: "+oe(t))}function ie(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function B(e,t,n,r){let i=ie(n,r);return i||(i=O(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function N(e,t,n){const r=ie(t,n);return r&&t._targets.remove(r),e}se(pt,b,{async evaluate(e,t,n){if(await b.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Ae(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&de(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&J(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=_(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",M(e)):M(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(D(e)||f("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(b.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(_(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:at,addEventListener(e,t,n){let r=t;return n&&n.trap===!1||(r=O(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),r=n.length,i,s;--r>=0;)if(s=n[r].type,i=n[r].handler,e===s&&(t===i||t===i.raw)){this._handler.off(s,i);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return B(this,e,_(this,e),t)},removeSignalListener(e,t){return N(this,_(this,e),t)},addDataListener(e,t){return B(this,e,z(this,e).values,t)},removeDataListener(e,t){return N(this,z(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=R(this,null);this._globalCursor=!!e,t&&R(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:dt,events:We,finalize:Ge,hover:Ve,data:Le,change:C,insert:xe,remove:Ee,scale:it,initialize:Ye,toImageURL:we,toCanvas:tt,toSVG:nt,getState:ot,setState:ct});export{pt as V};
