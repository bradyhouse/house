import{b as C,i as $,T as f,s as K,f as l}from"./vega-dataflow-7e3fa937.js";import{u as m,k as c,d as N,P as j,r as B,a6 as A}from"./vega-util-7f144c9d.js";import{h as I,p as w,a as F,s as E,t as H,b as V,c as G,d as J,e as Q,f as W,g as X,i as Y,j as Z}from"./d3-hierarchy-874b5d0d.js";function h(e,t,n){const s={};return e.each(a=>{const r=a.data;n(r)&&(s[t(r)]=a)}),e.lookup=s,e}function T(e){f.call(this,null,e)}T.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const _=e=>e.values;m(T,f,{transform(e,t){t.source||c("Nest transform requires an upstream data source.");var n=e.generate,s=e.modified(),a=t.clone(),r=this.value;return(!r||s||t.changed())&&(r&&r.each(i=>{i.children&&C(i.data)&&a.rem.push(i.data)}),this.value=r=I({values:N(e.keys).reduce((i,o)=>(i.key(o),i),ee()).entries(a.source)},_),n&&r.each(i=>{i.children&&(i=$(i.data),a.add.push(i),a.source.push(i))}),h(r,l,l)),a.source.root=r,a}});function ee(){const e=[],t={entries:a=>s(n(a,0),0),key:a=>(e.push(a),t)};function n(a,r){if(r>=e.length)return a;const i=a.length,o=e[r++],d={},x={};let R=-1,y,p,P;for(;++R<i;)y=o(p=a[R])+"",(P=d[y])?P.push(p):d[y]=[p];for(y in d)x[y]=n(d[y],r);return x}function s(a,r){if(++r>e.length)return a;const i=[];for(const o in a)i.push({key:o,values:s(a[o],r)});return i}return t}function u(e){f.call(this,null,e)}const te=(e,t)=>e.parent===t.parent?1:2;m(u,f,{transform(e,t){(!t.source||!t.source.root)&&c(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),s=this.fields,a=t.source.root,r=e.as||s;e.field?a.sum(e.field):a.count(),e.sort&&a.sort(K(e.sort,i=>i.data)),ae(n,this.params,e),n.separation&&n.separation(e.separation!==!1?te:j);try{this.value=n(a)}catch(i){c(i)}return a.each(i=>re(i,s,r)),t.reflow(e.modified()).modifies(r).modifies("leaf")}});function ae(e,t,n){for(let s,a=0,r=t.length;a<r;++a)s=t[a],s in n&&e[s](n[s])}function re(e,t,n){const s=e.data,a=t.length-1;for(let r=0;r<a;++r)s[n[r]]=e[t[r]];s[n[a]]=e.children?e.children.length:0}const g=["x","y","r","depth","children"];function D(e){u.call(this,e)}D.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:g.length,default:g}]};m(D,u,{layout:w,params:["radius","size","padding"],fields:g});const b=["x0","y0","x1","y1","depth","children"];function z(e){u.call(this,e)}z.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:b.length,default:b}]};m(z,u,{layout:F,params:["size","round","padding"],fields:b});function O(e){f.call(this,null,e)}O.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};m(O,f,{transform(e,t){t.source||c("Stratify transform requires an upstream data source.");let n=this.value;const s=e.modified(),a=t.fork(t.ALL).materialize(t.SOURCE),r=!n||s||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return a.source=a.source.slice(),r&&(n=a.source.length?h(E().id(e.key).parentId(e.parentKey)(a.source),e.key,A):h(E()([{}]),e.key,e.key)),a.source.root=this.value=n,a}});const M={tidy:V,cluster:G},k=["x","y","depth","children"];function S(e){u.call(this,e)}S.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:k.length,default:k}]};m(S,u,{layout(e){const t=e||"tidy";if(B(M,t))return M[t]();c("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:k});function q(e){f.call(this,[],e)}q.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};m(q,f,{transform(e,t){const n=this.value,s=t.source&&t.source.root,a=t.fork(t.NO_SOURCE),r={};return s||c("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(a.rem=n,t.visit(t.SOURCE,i=>r[l(i)]=1),s.each(i=>{const o=i.data,d=i.parent&&i.parent.data;d&&r[l(o)]&&r[l(d)]&&a.add.push($({source:d,target:o}))}),this.value=a.add):t.changed(t.MOD)&&(t.visit(t.MOD,i=>r[l(i)]=1),n.forEach(i=>{(r[l(i.source)]||r[l(i.target)])&&a.mod.push(i)})),a}});const U={binary:J,dice:Q,slice:W,slicedice:X,squarify:Y,resquarify:Z},v=["x0","y0","x1","y1","depth","children"];function L(e){u.call(this,e)}L.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:v.length,default:v}]};m(L,u,{layout(){const e=H();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{B(U,t)?e.tile(U[t]):c("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:v});const oe=Object.freeze(Object.defineProperty({__proto__:null,nest:T,pack:D,partition:z,stratify:O,tree:S,treelinks:q,treemap:L},Symbol.toStringTag,{value:"Module"}));export{oe as t};
