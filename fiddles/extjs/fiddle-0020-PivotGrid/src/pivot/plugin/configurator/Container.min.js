Ext.define("Ext.pivot.plugin.configurator.Container",{extend:"Ext.panel.Panel",requires:["Ext.pivot.plugin.configurator.Column","Ext.pivot.plugin.configurator.DragZone","Ext.pivot.plugin.configurator.DropZone"],alias:"widget.pivotconfigcontainer",childEls:["innerCt","targetEl"],handleSorting:false,handleFiltering:false,position:"top",isAgg:false,border:false,dragDropText:"Drop Column Fields Here",cls:Ext.baseCSSPrefix+"pivot-grid-config-container-body",dockedTopRightCls:Ext.baseCSSPrefix+"pivot-grid-config-container-body-tr",dockedBottomLeftCls:Ext.baseCSSPrefix+"pivot-grid-config-container-body-bl",hintTextCls:Ext.baseCSSPrefix+"pivot-grid-config-container-hint",initComponent:function(){var a=this;if(a.position=="top"||a.position=="bottom"){Ext.apply(a,{style:"overflow:hidden",layout:"column",height:"auto"})}else{Ext.apply(a,{layout:{type:"vbox",align:"stretch"}})}if(a.position=="top"||a.position=="right"){a.cls+=" "+a.dockedTopRightCls}else{a.cls+=" "+a.dockedBottomLeftCls}a.callParent(arguments)},destroy:function(){var a=this;Ext.destroyMembers(a,"dragZone","dropZone","relayers","targetEl");a.dragZone=a.dropZone=a.relayers=a.targetEl=null;a.callParent()},enable:function(){var a=this;if(a.dragZone){a.dragZone.enable()}if(a.dropZone){a.dropZone.enable()}},disable:function(){var a=this;if(a.dragZone){a.dragZone.disable()}if(a.dropZone){a.dropZone.disable()}},afterRender:function(){var a=this;a.callParent();a.dragZone=new Ext.pivot.plugin.configurator.DragZone(a);a.dropZone=new Ext.pivot.plugin.configurator.DropZone(a);a.mon(a,"afterlayout",a.showGroupByText,a)},addColumn:function(b,g,c){var d=this,a={xtype:"pivotconfigcolumn"},f=d.items.findIndex("dimensionId",new RegExp("^"+b.id+"$","i"))>=0,e;if(!d.isAgg){if(f){if(c===true){d.notifyGroupChange()}return}}else{if(f){b.id=Ext.id()}}if(d.items.getCount()==0){d.hideGroupByText()}Ext.apply(a,{dimension:b,dimensionId:b.id,header:b.header,isCustomizable:d.isCustomizable,isAgg:d.isAgg});if(d.isAgg){b.aggregator=b.aggregator||"sum"}if(g!=-1){e=d.insert(g,a)}else{e=d.add(a)}d.updateColumnIndexes();e.relayers=d.relayEvents(e,["sortchange","filterchange","configchange"]);if(c===true){d.notifyGroupChange()}},getColumnPosition:function(b,a){var c=this,d;if(b instanceof Ext.pivot.plugin.configurator.Column){d=c.items.findIndex("id",b.id);d=(a==="before")?d:d+1}else{d=-1}return d},moveColumn:function(e,b,a){var d=this,f=d.items.findIndex("id",e),c=d.items.findIndex("id",b);if(f!=c){if(c>f){c=(a==="before")?Math.max(c-1,0):c}else{c=(a==="before")?c:c+1}d.move(f,c);d.updateColumnIndexes();d.notifyGroupChange()}},updateColumnIndexes:function(){this.items.each(function(c,a,b){c.index=a})},notifyGroupChange:function(){this.fireEvent("configchange")},showGroupByText:function(){var a=this;if(a.items.getCount()===0){a.innerCt.setHeight(a.minHeight);if(a.targetEl){a.targetEl.setHtml('<div class="'+a.hintTextCls+'">'+a.dragDropText+"</div>")}else{a.targetEl=a.innerCt.createChild()}}},hideGroupByText:function(){if(this.targetEl){this.targetEl.setHtml("")}}});