Ext.define("Ext.pivot.feature.PivotView",{extend:"Ext.pivot.feature.PivotEvents",alias:"feature.pivotview",groupTitleCls:Ext.baseCSSPrefix+"pivot-grid-group-title",groupHeaderCollapsedCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsed",tableCls:Ext.baseCSSPrefix+"grid-table",rowCls:Ext.baseCSSPrefix+"grid-row",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",outlineCellHiddenCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-hidden",outlineCellGroupExpandedCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-previous-expanded",compactGroupHeaderCls:Ext.baseCSSPrefix+"pivot-grid-group-header-compact",compactLayoutPadding:25,outerTpl:["{%","var me = this.pivotViewFeature;","if (!(me.disabled)) {","me.setup();","}","this.nextTpl.applyOut(values, out, parent);","%}",{priority:200}],rowTpl:["{%","var me = this.pivotViewFeature;","me.setupRowData(values.record, values.rowIndex, values);","values.view.renderColumnSizer(values, out);","this.nextTpl.applyOut(values, out, parent);","me.resetRenderers();","%}",{priority:200,syncRowHeights:function(d,a){var b,c;d=Ext.fly(d,"syncDest");if(d){b=d.offsetHeight}a=Ext.fly(a,"sycSrc");if(a){c=a.offsetHeight}if(d&&a){if(b>c){Ext.fly(a).setHeight(b)}else{if(c>b){Ext.fly(d).setHeight(c)}}}}}],cellTpl:["{%",'values.hideCell = values.tdAttr == "hidden";\n',"%}",'<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" ',"{cellInnerAttr:attributes}>{value}</div>","</td>","</tpl>",{priority:0}],rtlCellTpl:["{%",'values.hideCell = values.tdAttr == "hidden";\n',"%}",'<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" ',"{cellInnerAttr:attributes}>{value}</div>","</td>","</tpl>",{priority:200,rtlAlign:{right:"left",left:"right",center:"center"},getAlign:function(a){return this.rtlAlign[a]}}],init:function(b){var c=this,a=c.view;c.callParent(arguments);a.addTpl(Ext.XTemplate.getTpl(c,"outerTpl")).pivotViewFeature=c;a.addRowTpl(Ext.XTemplate.getTpl(c,"rowTpl")).pivotViewFeature=c;a.preserveScrollOnRefresh=true;if(a.bufferedRenderer){a.bufferedRenderer.variableRowHeight=true}else{b.variableRowHeight=a.variableRowHeight=true}},destroy:function(){this.columns=null;this.callParent(arguments)},setup:function(){this.columns=this.view.getGridColumns()},isRTL:function(){var b=this,a=b.gridMaster||b.grid;if(Ext.isFunction(a.isLocalRtl)){return a.isLocalRtl()}return false},getGridListeners:function(){var a=this;return Ext.apply(a.callParent(arguments)||{},{beforerender:a.onBeforeGridRendered})},onBeforeGridRendered:function(a){var b=this;if(b.isRTL()){b.view.addCellTpl(Ext.XTemplate.getTpl(b,"rtlCellTpl"))}else{b.view.addCellTpl(Ext.XTemplate.getTpl(b,"cellTpl"))}},vetoEvent:function(a,c,d,b){if(b.type!=="mouseover"&&b.type!=="mouseout"&&b.type!=="mouseenter"&&b.type!=="mouseleave"&&b.getTarget(this.eventSelector)){return false}},setupRowData:function(b,a,e){var d=this.dataSource.storeInfo[b.internalId],c=d?d.rendererParams:{};e.rowClasses.length=0;Ext.Array.insert(e.rowClasses,0,d?d.rowClasses:[]);this.setRenderers(c)},setRenderers:function(a){Ext.Array.each(this.columns,function(b){if(Ext.isDefined(a[b.dataIndex])){b.savedRenderer=b.renderer;b.renderer=this[a[b.dataIndex].fn](Ext.apply({renderer:b.savedRenderer},a[b.dataIndex]))}else{if(Ext.isDefined(a.topaxis)){b.savedRenderer=b.renderer;b.renderer=this[a.topaxis.fn](Ext.apply({renderer:b.savedRenderer},a[b.dataIndex]))}}},this)},resetRenderers:function(){Ext.Array.each(this.columns,function(a){if(Ext.isDefined(a.savedRenderer)){a.renderer=a.savedRenderer;delete a.savedRenderer}})},groupOutlineRenderer:function(b){var e=this,c=b.renderer,g=b.group,h=b.colspan,f=b.hidden,a=b.previousExpanded,d=b.subtotalRow;return function(n,k,j,o,m,l,i){if(Ext.isFunction(c)){n=c.apply(this,arguments)}n=e.encodeValue(n,g);if(h>0){k.tdAttr='colspan = "'+h+'"';k.tdCls=e.groupHeaderCls;if(!d){k.tdCls+=" "+e.groupHeaderCollapsibleCls;if(!g.expanded){k.tdCls+=" "+e.groupHeaderCollapsedCls}if(a){k.tdCls+=" "+e.outlineCellGroupExpandedCls}}return'<div class="'+e.groupTitleCls+'">'+n+"</div>"}if(f){k.tdAttr="hidden"}k.tdCls=e.outlineCellHiddenCls;return""}},recordOutlineRenderer:function(a){var c=this,b=a.renderer,e=a.group,d=a.hidden;return function(k,h,g,l,j,i,f){if(Ext.isFunction(b)){k=b.apply(this,arguments)}k=c.encodeValue(k,e);if(d){h.tdCls=c.outlineCellHiddenCls;return""}h.tdCls=c.groupHeaderCls+" "+c.groupTitleCls;return k}},groupCompactRenderer:function(b){var e=this,c=b.renderer,f=b.group,g=b.colspan,a=b.previousExpanded,d=b.subtotalRow;return function(m,j,i,n,l,k,h){if(Ext.isFunction(c)){m=c.apply(this,arguments)}m=e.encodeValue(m,f);if(f.level>0){j.style=(e.isRTL()?"margin-right: ":"margin-left: ")+(e.compactLayoutPadding*f.level)+"px;"}j.tdCls=e.groupHeaderCls+" "+e.compactGroupHeaderCls;if(!d){j.tdCls+=" "+e.groupHeaderCollapsibleCls;if(!f.expanded){j.tdCls+=" "+e.groupHeaderCollapsedCls}if(a){j.tdCls+=" "+e.outlineCellGroupExpandedCls}}return'<div class="'+e.groupTitleCls+'">'+m+"</div>"}},recordCompactRenderer:function(a){var c=this,b=a.renderer,d=a.group;return function(j,g,f,k,i,h,e){if(Ext.isFunction(b)){j=b.apply(this,arguments)}j=c.encodeValue(j,d);if(d.level>0){g.style=(c.isRTL()?"margin-right: ":"margin-left: ")+(c.compactLayoutPadding*d.level)+"px;"}g.tdCls=c.groupHeaderCls+" "+c.groupTitleCls+" "+c.compactGroupHeaderCls;return j}},topAxisNoRenderer:function(a){return function(g,d,c,h,f,e,b){return""}},topAxisRenderer:function(a){var c=this,b=a.renderer;return function(i,f,e,k,h,g,d){var j=(i===0&&c.gridMaster.showZeroAsBlank);if(Ext.isFunction(b)){i=b.apply(this,arguments)}return j?"":i}},encodeValue:function(a,b){return a}});