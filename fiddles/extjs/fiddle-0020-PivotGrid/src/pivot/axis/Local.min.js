Ext.define("Ext.pivot.axis.Local",{alternateClassName:["Mz.aggregate.axis.Local"],extend:"Ext.pivot.axis.Base",alias:"pivotaxis.local",processRecord:function(d){var f=this,e=[],g="",j=true,h=f.dimensions.getCount(),a,k,b,c;for(c=0;c<h;c++){b=f.dimensions.getAt(c);a=b.grouperFn(d);k=g?g+f.matrix.keysSeparator:"";a=Ext.isEmpty(a)?b.blankText:a;k+=f.matrix.getKey(a);if(b.filter instanceof Ext.pivot.filter.Label){j=b.filter.isMatch(a)}if(!j){break}e.push({value:a,sortValue:d.get(b.sortIndex),key:k,dimensionId:b.getId()});g=k}if(j){return e}else{return null}},buildTree:function(){this.callParent(arguments);this.filterTree()},filterTree:function(){var d=this,c=d.dimensions.getCount(),a=false,b;for(b=0;b<c;b++){a=a||(d.dimensions.getAt(b).filter instanceof Ext.pivot.filter.Value)}if(!a){return}d.matrix.filterApplied=true;d.filterTreeItems(d.tree)},filterTreeItems:function(a){var d=this,c,b,e;if(!a||!Ext.isArray(a)||a.length<=0){return}c=a[0].dimension.filter;if(c&&(c instanceof Ext.pivot.filter.Value)){if(c.isTopFilter){e=c.applyFilter(d,a)||[]}else{e=Ext.Array.filter(a,d.canRemoveItem,d)}d.removeRecordsFromResults(e);d.removeItemsFromArray(a,e);for(b=0;b<e.length;b++){d.removeTreeChildren(e[b])}}for(b=0;b<a.length;b++){if(a[b].children){d.filterTreeItems(a[b].children);if(a[b].children.length===0){d.items.remove(a[b]);Ext.Array.erase(a,b,1);b--}}}},removeTreeChildren:function(c){var b,a;if(c.children){a=c.children.length;for(b=0;b<a;b++){this.removeTreeChildren(c.children[b])}}this.items.remove(c)},canRemoveItem:function(d){var c=this,f=(c.isLeftAxis?d.key:c.matrix.grandTotalKey),e=(c.isLeftAxis?c.matrix.grandTotalKey:d.key),a=c.matrix.results.get(f,e),b=d.dimension.filter;return(a?!b.isMatch(a.getValue(b.dimensionId)):false)},removeItemsFromArray:function(c,a){for(var b=0;b<c.length;b++){if(Ext.Array.indexOf(a,c[b])>=0){Ext.Array.erase(c,b,1);b--}}},removeRecordsFromResults:function(a){for(var b=0;b<a.length;b++){this.removeRecordsByItem(a[b])}},removeRecordsByItem:function(g){var f=this,e,c,b,a,d;if(g.children){f.removeRecordsFromResults(g.children)}if(f.isLeftAxis){d=f.matrix.results.get(g.key,f.matrix.grandTotalKey);b=f.matrix.results.getByLeftKey(f.matrix.grandTotalKey)}else{d=f.matrix.results.get(f.matrix.grandTotalKey,g.key);b=f.matrix.results.getByTopKey(f.matrix.grandTotalKey)}if(!d){return}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e=g.key.split(f.matrix.keysSeparator);e.length=e.length-1;while(e.length>0){if(f.isLeftAxis){b=f.matrix.results.getByLeftKey(e.join(f.matrix.keysSeparator))}else{b=f.matrix.results.getByTopKey(e.join(f.matrix.keysSeparator))}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e.length=e.length-1}}});