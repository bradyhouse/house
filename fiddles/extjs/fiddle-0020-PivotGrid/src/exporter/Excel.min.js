Ext.define("Ext.exporter.Excel",{extend:"Ext.exporter.Base",alias:"exporter.excel",requires:["Ext.exporter.file.excel.Workbook"],config:{windowHeight:9000,windowWidth:50000,protectStructure:false,protectWindows:false,defaultStyle:{alignment:{Vertical:"Top"},font:{FontName:"Calibri",Family:"Swiss",Size:11,Color:"#000000"}},titleStyle:{name:"Title",alignment:{Horizontal:"Center",Vertical:"Center"},font:{FontName:"Cambria",Family:"Swiss",Size:18,Color:"#1F497D"}},groupHeaderStyle:{name:"Group Header",borders:[{Position:"Bottom",LineStyle:"Continuous",Weight:1,Color:"#4F81BD"}]},groupFooterStyle:{name:"Total Footer",borders:[{Position:"Top",LineStyle:"Continuous",Weight:1,Color:"#4F81BD"}]},tableHeaderStyle:{name:"Heading 1",alignment:{Horizontal:"Center",Vertical:"Center"},borders:[{Position:"Bottom",LineStyle:"Continuous",Weight:1,Color:"#4F81BD"}],font:{FontName:"Calibri",Family:"Swiss",Size:11,Color:"#1F497D"}}},fileName:"export.xml",destroy:function(){Ext.destroyMembers(this,"workbook","table");this.workbook=this.table=null;return this.callParent(arguments)},applyDefaultStyle:function(a){return Ext.applyIf({id:"Default",name:"Normal"},a||{})},getContent:function(){var b=this,a=this.getConfig(),c=a.data,d;b.workbook=Ext.create("Ext.exporter.file.excel.Workbook",{title:a.title,author:a.author,windowHeight:a.windowHeight,windowWidth:a.windowWidth,protectStructure:a.protectStructure,protectWindows:a.protectWindows});b.table=b.workbook.addWorksheet({name:a.title}).addTable();b.workbook.addStyle(a.defaultStyle);b.tableHeaderStyleId=b.workbook.addStyle(a.tableHeaderStyle).getId();b.groupHeaderStyleId=b.workbook.addStyle(a.groupHeaderStyle).getId();b.groupFooterStyleId=b.workbook.addStyle(a.groupFooterStyle).getId();d=b.getColumnCount(c.columns);b.addTitle(a,d);b.buildHeader();b.buildRows(d);return b.workbook.render()},addTitle:function(a,b){if(!Ext.isEmpty(a.title)){this.table.addRow({autoFitHeight:1,height:22.5,styleId:this.workbook.addStyle(a.titleStyle).getId()}).addCell({mergeAcross:b-1,value:a.title})}},buildRows:function(f){var c=this,d=c.getData(),a=Ext.isDefined(d.groups)?d.groups:Ext.Array.from(d),e;c.buildSummaryRows(a,f,1);if(c.getShowSummary()!==false&&Ext.isDefined(d.groups)&&d.summary&&d.summary.length>0){e=c.table.addRow({styleId:c.groupFooterStyleId});for(var b=0;b<d.summary.length;b++){e.addCell({value:d.summary[b]})}}},buildSummaryRows:function(c,a,b){var k=this,f=k.getShowSummary(),h,n,l,m;if(!c){return}l=k.workbook.addStyle({parentId:k.groupHeaderStyleId,alignment:{Horizontal:"Left",Indent:b-1}});m=k.workbook.addStyle({parentId:k.groupFooterStyleId,alignment:{Horizontal:"Left",Indent:b-1}});for(var e=0;e<c.length;e++){h=c[e];if(f!==false&&!Ext.isEmpty(h.text)){k.table.addRow({styleId:k.groupHeaderStyleId}).addCell({mergeAcross:a-1,value:h.text,styleId:l.getId()})}k.buildSummaryRows(h.groups,a,b+1);k.buildGroupRows(h.rows);if(f!==false&&h.summary&&h.summary.length>0){n=k.table.addRow({styleId:k.groupFooterStyleId});for(var d=0;d<h.summary.length;d++){n.addCell({value:h.summary[d],styleId:(d===0?m.getId():null)})}}}},buildGroupRows:function(b){var a,e,d,c;if(!b){return}for(d=0;d<b.length;d++){e=this.table.addRow();a=b[d];for(c=0;c<a.length;c++){e.addCell({value:a[c]})}}},buildHeader:function(){var g=this,d={},f,h,e,c,a,b;g.buildHeaderRows(g.getData().columns,d);f=Ext.Object.getKeys(d);a=f.length;for(e=0;e<a;e++){h=g.table.addRow({height:20.25,autoFitHeight:1,styleId:g.tableHeaderStyleId});b=d[f[e]].length;for(c=0;c<b;c++){h.addCell(d[f[e]][c])}}},buildHeaderRows:function(d,a){var b,f,e;if(!d){return}for(var c=0;c<d.length;c++){b=d[c];f=this.getColumnCount(b.columns);a["s"+b.level]=a["s"+b.level]||[];e={value:this.sanitizeHtml(b.text)};if(f>1){Ext.apply(e,{mergeAcross:f-1})}a["s"+b.level].push(e);this.buildHeaderRows(b.columns,a)}},sanitizeHtml:function(a){a=String(a).replace("<br>"," ");a=a.replace("<br/>"," ");return a.replace(/<\/?[^>]+>/gi,"")}});