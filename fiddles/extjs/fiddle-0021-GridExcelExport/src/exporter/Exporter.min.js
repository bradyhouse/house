Ext.define("Ext.grid.plugin.Exporter",{alias:["plugin.gridexporter"],extend:"Ext.AbstractPlugin",requires:["Ext.exporter.Excel"],lockableScope:"top",init:function(a){var b=this;a.saveDocumentAs=Ext.bind(b.saveDocumentAs,b);a.getDocumentData=Ext.bind(b.getDocumentData,b);b.grid=a;return b.callParent(arguments)},destroy:function(){var a=this;a.grid.saveDocumentAs=a.grid.getDocumentData=a.grid=null;return a.callParent(arguments)},saveDocumentAs:function(a){var b;if(this.disabled){return}b=this.getExporter.apply(this,arguments);b.saveAs();Ext.destroy(b)},getDocumentData:function(b){var c,a;if(this.disabled){return}c=this.getExporter.apply(this,arguments);a=c.getContent();Ext.destroy(c);return a},getExporter:function(a){return Ext.Factory.exporter(Ext.apply({type:"excel",data:this.prepareData()},a||{}))},prepareData:function(){var b=this,a=b.grid,d,c;c=b.extractGroups(a.getColumnManager().getColumns());if(a.lockedGrid){d=Ext.Array.merge(b.getColumnHeaders(a.lockedGrid.headerCt.items),b.getColumnHeaders(a.normalGrid.headerCt.items))}else{d=b.getColumnHeaders(a.headerCt.items)}return{columns:d,groups:[c]}},getColumnHeaders:function(c){var e=[],b,d,a;for(b=0;b<c.length;b++){a=c.get(b);if(!a.ignoreExport){d={text:a.text};if(a.isGroupHeader){d.columns=this.getColumnHeaders(a.items);if(d.columns.length===0){d=null}}if(d){e.push(d)}}}return e},extractGroups:function(c){var k=this.grid.getStore(),g=k.getCount(),b=c.length,m={rows:[]},e,d,f,n,a,h,l;for(e=0;e<g;e++){f=k.getAt(e);n=[];for(d=0;d<b;d++){a=c[d];if(!a.ignoreExport){h=!Ext.isEmpty(a.initialConfig.formatter)&&Ext.isEmpty(a.formatter);l=f.get(a.dataIndex)||"";n.push(h?a.renderer(l):l)}}m.rows.push(n)}return m}});